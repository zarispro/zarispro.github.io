function checkLogCount(e){e&&!e[3]&&uaResult.device&&uaResult.os&&(e[1].ua_model_sys=uaResult.device.model+"&"+uaResult.os.name+" "+uaResult.os.version),e&&!e[3]&&(e[1].appid=APPINFO.APP_ID),e&&e[3]&&(e[1].fanxid=KgUser&&KgUser.getKgMid()||"",e[1].uid=userInfo&&userInfo.uid),apmCollectData.push(e);try{Kg.UA.isWeiXin?logCount.wxReady&&newLogCount():newLogCount()}catch(e){}}function hex_md5(e){return rstr2hex(rstr_md5(str2rstr_utf8(e)))}function b64_md5(e){return rstr2b64(rstr_md5(str2rstr_utf8(e)))}function any_md5(e,a){return rstr2any(rstr_md5(str2rstr_utf8(e)),a)}function hex_hmac_md5(e,a){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(a)))}function b64_hmac_md5(e,a){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(a)))}function any_hmac_md5(e,a,t){return rstr2any(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(a)),t)}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc").toLowerCase()}function rstr_md5(e){return binl2rstr(binl_md5(rstr2binl(e),8*e.length))}function rstr_hmac_md5(e,a){var t,o,i,n,r=rstr2binl(e);for(r.length>16&&(r=binl_md5(r,8*e.length)),t=Array(16),o=Array(16),i=0;16>i;i++)t[i]=909522486^r[i],o[i]=1549556828^r[i];return n=binl_md5(t.concat(rstr2binl(a)),512+8*a.length),binl2rstr(binl_md5(o.concat(n),640))}function rstr2hex(e){var a,t,o,i;for(a=hexcase?"0123456789ABCDEF":"0123456789abcdef",t="",i=0;i<e.length;i++)o=e.charCodeAt(i),t+=a.charAt(15&o>>>4)+a.charAt(15&o);return t}function rstr2b64(e){var a,t,o,i,n,r;for(a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t="",o=e.length,i=0;o>i;i+=3)for(n=e.charCodeAt(i)<<16|(o>i+1?e.charCodeAt(i+1)<<8:0)|(o>i+2?e.charCodeAt(i+2):0),r=0;4>r;r++)t+=8*i+6*r>8*e.length?b64pad:a.charAt(63&n>>>6*(3-r));return t}function rstr2any(e,a){var t,o,i,n,r,s,d,l,p=a.length,c=Array(Math.ceil(e.length/2));for(t=0;t<c.length;t++)c[t]=e.charCodeAt(2*t)<<8|e.charCodeAt(2*t+1);for(s=Math.ceil(8*e.length/(Math.log(a.length)/Math.log(2))),d=Array(s),o=0;s>o;o++){for(r=Array(),n=0,t=0;t<c.length;t++)n=(n<<16)+c[t],i=Math.floor(n/p),n-=i*p,(r.length>0||i>0)&&(r[r.length]=i);d[o]=n,c=r}for(l="",t=d.length-1;t>=0;t--)l+=a.charAt(d[t]);return l}function str2rstr_utf8(e){for(var a,t,o="",i=-1;++i<e.length;)a=e.charCodeAt(i),t=i+1<e.length?e.charCodeAt(i+1):0,a>=55296&&56319>=a&&t>=56320&&57343>=t&&(a=65536+((1023&a)<<10)+(1023&t),i++),127>=a?o+=String.fromCharCode(a):2047>=a?o+=String.fromCharCode(192|31&a>>>6,128|63&a):65535>=a?o+=String.fromCharCode(224|15&a>>>12,128|63&a>>>6,128|63&a):2097151>=a&&(o+=String.fromCharCode(240|7&a>>>18,128|63&a>>>12,128|63&a>>>6,128|63&a));return o}function str2rstr_utf16le(e){var a,t="";for(a=0;a<e.length;a++)t+=String.fromCharCode(255&e.charCodeAt(a),255&e.charCodeAt(a)>>>8);return t}function str2rstr_utf16be(e){var a,t="";for(a=0;a<e.length;a++)t+=String.fromCharCode(255&e.charCodeAt(a)>>>8,255&e.charCodeAt(a));return t}function rstr2binl(e){var a,t=Array(e.length>>2);for(a=0;a<t.length;a++)t[a]=0;for(a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function binl2rstr(e){var a,t="";for(a=0;a<32*e.length;a+=8)t+=String.fromCharCode(255&e[a>>5]>>>a%32);return t}function binl_md5(e,a){var t,o,i,n,r,s,d,l,p;for(e[a>>5]|=128<<a%32,e[14+(a+64>>>9<<4)]=a,t=1732584193,o=-271733879,i=-1732584194,n=271733878,r=0;r<e.length;r+=16)s=t,d=o,l=i,p=n,t=md5_ff(t,o,i,n,e[r+0],7,-680876936),n=md5_ff(n,t,o,i,e[r+1],12,-389564586),i=md5_ff(i,n,t,o,e[r+2],17,606105819),o=md5_ff(o,i,n,t,e[r+3],22,-1044525330),t=md5_ff(t,o,i,n,e[r+4],7,-176418897),n=md5_ff(n,t,o,i,e[r+5],12,1200080426),i=md5_ff(i,n,t,o,e[r+6],17,-1473231341),o=md5_ff(o,i,n,t,e[r+7],22,-45705983),t=md5_ff(t,o,i,n,e[r+8],7,1770035416),n=md5_ff(n,t,o,i,e[r+9],12,-1958414417),i=md5_ff(i,n,t,o,e[r+10],17,-42063),o=md5_ff(o,i,n,t,e[r+11],22,-1990404162),t=md5_ff(t,o,i,n,e[r+12],7,1804603682),n=md5_ff(n,t,o,i,e[r+13],12,-40341101),i=md5_ff(i,n,t,o,e[r+14],17,-1502002290),o=md5_ff(o,i,n,t,e[r+15],22,1236535329),t=md5_gg(t,o,i,n,e[r+1],5,-165796510),n=md5_gg(n,t,o,i,e[r+6],9,-1069501632),i=md5_gg(i,n,t,o,e[r+11],14,643717713),o=md5_gg(o,i,n,t,e[r+0],20,-373897302),t=md5_gg(t,o,i,n,e[r+5],5,-701558691),n=md5_gg(n,t,o,i,e[r+10],9,38016083),i=md5_gg(i,n,t,o,e[r+15],14,-660478335),o=md5_gg(o,i,n,t,e[r+4],20,-405537848),t=md5_gg(t,o,i,n,e[r+9],5,568446438),n=md5_gg(n,t,o,i,e[r+14],9,-1019803690),i=md5_gg(i,n,t,o,e[r+3],14,-187363961),o=md5_gg(o,i,n,t,e[r+8],20,1163531501),t=md5_gg(t,o,i,n,e[r+13],5,-1444681467),n=md5_gg(n,t,o,i,e[r+2],9,-51403784),i=md5_gg(i,n,t,o,e[r+7],14,1735328473),o=md5_gg(o,i,n,t,e[r+12],20,-1926607734),t=md5_hh(t,o,i,n,e[r+5],4,-378558),n=md5_hh(n,t,o,i,e[r+8],11,-2022574463),i=md5_hh(i,n,t,o,e[r+11],16,1839030562),o=md5_hh(o,i,n,t,e[r+14],23,-35309556),t=md5_hh(t,o,i,n,e[r+1],4,-1530992060),n=md5_hh(n,t,o,i,e[r+4],11,1272893353),i=md5_hh(i,n,t,o,e[r+7],16,-155497632),o=md5_hh(o,i,n,t,e[r+10],23,-1094730640),t=md5_hh(t,o,i,n,e[r+13],4,681279174),n=md5_hh(n,t,o,i,e[r+0],11,-358537222),i=md5_hh(i,n,t,o,e[r+3],16,-722521979),o=md5_hh(o,i,n,t,e[r+6],23,76029189),t=md5_hh(t,o,i,n,e[r+9],4,-640364487),n=md5_hh(n,t,o,i,e[r+12],11,-421815835),i=md5_hh(i,n,t,o,e[r+15],16,530742520),o=md5_hh(o,i,n,t,e[r+2],23,-995338651),t=md5_ii(t,o,i,n,e[r+0],6,-198630844),n=md5_ii(n,t,o,i,e[r+7],10,1126891415),i=md5_ii(i,n,t,o,e[r+14],15,-1416354905),o=md5_ii(o,i,n,t,e[r+5],21,-57434055),t=md5_ii(t,o,i,n,e[r+12],6,1700485571),n=md5_ii(n,t,o,i,e[r+3],10,-1894986606),i=md5_ii(i,n,t,o,e[r+10],15,-1051523),o=md5_ii(o,i,n,t,e[r+1],21,-2054922799),t=md5_ii(t,o,i,n,e[r+8],6,1873313359),n=md5_ii(n,t,o,i,e[r+15],10,-30611744),i=md5_ii(i,n,t,o,e[r+6],15,-1560198380),o=md5_ii(o,i,n,t,e[r+13],21,1309151649),t=md5_ii(t,o,i,n,e[r+4],6,-145523070),n=md5_ii(n,t,o,i,e[r+11],10,-1120210379),i=md5_ii(i,n,t,o,e[r+2],15,718787259),o=md5_ii(o,i,n,t,e[r+9],21,-343485551),t=safe_add(t,s),o=safe_add(o,d),i=safe_add(i,l),n=safe_add(n,p);return Array(t,o,i,n)}function md5_cmn(e,a,t,o,i,n){return safe_add(bit_rol(safe_add(safe_add(a,e),safe_add(o,n)),i),t)}function md5_ff(e,a,t,o,i,n,r){return md5_cmn(a&t|~a&o,e,a,i,n,r)}function md5_gg(e,a,t,o,i,n,r){return md5_cmn(a&o|t&~o,e,a,i,n,r)}function md5_hh(e,a,t,o,i,n,r){return md5_cmn(a^t^o,e,a,i,n,r)}function md5_ii(e,a,t,o,i,n,r){return md5_cmn(t^(a|~o),e,a,i,n,r)}function safe_add(e,a){var t=(65535&e)+(65535&a),o=(e>>16)+(a>>16)+(t>>16);return o<<16|65535&t}function bit_rol(e,a){return e<<a|e>>>32-a}function DOMready(e){document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),e()},!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"==document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),e())})}function downloadSong(e){4==e.privilege?LogStat({p1:"分享H5页面",p2:"单曲",name:"点击-发现更多好音乐",type:1}):(LogStat({p1:"分享H5页面",p2:"单曲",name:"“下载这首歌”点击量",type:1}),LogStat({p1:"分享H5页面",p2:"单曲",p3:_chl,name:_chl+"-下载这首歌",type:1}),Kg.UA.isWeiXin||Kg.UA.isWeibo||Kg.UA.isMobileQQ||Kg.UA.isQzone&&Kg.UA.android||Kg.UA.isMQQBrowser&&Kg.UA.android||LogStat({p1:"分享H5页面",p2:"单曲",p3:"浏览器",name:_chl+"-下载这首歌",type:1})),setTimeout(function(){let a=e;if(a&&4!=a.privilege){var t={cmd:301},o={};Kg.UA.iphone?(o.size=a.fileSize||0,a.extra["320filesize"]&&(o["320size"]=a.extra["320filesize"]),a.extra.sqfilesize&&(o.sqsize=a.extra.sqfilesize)):(o.filesize=a.fileSize||0,a.extra["320filesize"]&&(o["320filesize"]=a.extra["320filesize"]),a.extra.sqfilesize&&(o.sqfilesize=a.extra.sqfilesize)),o.hash=a.hash||0,o.filename=a.fileName||a.filename,o.bitrate=a.bitRate||a.bitrate||0,o.duration=a.timeLength||a.time_length||0,o.extname=a.extName||a.extname||0,o.privilege=a.privilege||"",o["320privilege"]=a["320privilege"]||"",o.sqprivilege=a.sqprivilege||"",o.album_audio_id=a.album_audio_id||"",o.trans_param=a.trans_param||"",o.chl=phpParam.chl||"",o.chl2=phpParam.chl2||"",o.secondShareChl=secondShareChl,o.userid=phpParam.u||"",a.extra["320hash"]&&(o["320hash"]=a.extra["320hash"]),a.extra.sqhash&&(o.sqhash=a.extra.sqhash),o.album_id=phpParam.album_id?phpParam.album_id:Kg.request.search("album_id")?Kg.request.search("album_id"):"",o.isplay=0,phpParam.mdli&&(o.mdli=phpParam.mdli),phpParam.u&&phpParam.h1&&(o.u=phpParam.u,o.h1=phpParam.h1),phpParam.h2&&(o.h2=phpParam.h2),window.searchSource?o.pull_channel_id=window.searchSource:o.cyt1=logCount.cyt1,o.btnh5=a.btnh5,o.cyt2=a.cyt2,t.jsonStr=o;var i=getSource();i&&t.jsonStr&&(t.jsonStr.hreffrom=i),downloadModule.openKg(t)}},200)}function getSource(){var e=window.location.pathname.match(/kgmixsong\/(\S)\//);if(!e||!e[1])return/frombaidu/.test(location.search)?"baidulunbo":window.location.href.indexOf("tthezuo")>-1?"tthezuo":void 0;switch(e[1]){case"b":return"baidusousuo";case"t":return"toutiao"}}function isTest(e,a){var t={isGraySongs:(!1,!0),isTargetClient:!1,hasEffectiveCookie:(!1,null)};Kg.UA.isWeiXin&&(t.isTargetClient=!0),t.isTargetClient&&t.isGraySongs&&!t.hasEffectiveCookie?cookie.setCookie("isGrayTarget",(new Date).getTime(),new Date((new Date).getTime()+1728e5)):console.log("no istest")}function vipShareActivityBI(e,a,t,o){checkLogCount([30050,{a:e,b:a,ft:t,r:"分享活动",mid:KgUser.getKgMid(),userid:phpParam.u,svar1:phpParam.album_audio_id||"",svar2:_chl||"",svar3:o||""},null,!1])}function showListenDialog(){if(phpParam.imgurl&&phpParam.song_info&&phpParam.song_info.data&&phpParam.song_info.data.songName){var e='<div class="listen-dialog" id="listen-dialog"><div class="mask"></div><div class="listen-dialog-inner"><div class="listen_header"><div class="album_img" style="background-image:url('+phpParam.imgurl+')"></div><div class="song"><p class="nowrap1">'+phpParam.song_info.data.songName+'</p><div><span>正在收听</span><div class="playing_bar_wrap"><span class="playing__bar playing__bar1"></span><span class="playing__bar playing__bar2"></span><span class="playing__bar playing__bar3"></span></div></div></div></div><div class="listen_body"><p class="title">打开酷狗音乐，尽享丰富听歌体验</p><div class="itemList"><div class="item"><i></i><span>蝰蛇音效<span></div><div class="item"><i></i><span>千万曲库<span></div><div class="item"><i></i><span>超清MV<span></div></div></div><div class="listen-dialog-ft">打开收听</div><div class="listen-dialog-close" id="listen-dialog-close"></div></div>';Kg.$("body").append(e),Kg.$("#listen-dialog-close").addEvent("click",function(){Kg.$("#listen-dialog").hide(),checkLogCount([30050,{a:26540,b:"点击",ft:"单曲分享H5-导流弹窗",r:"单曲分享H5",mid:KgUser.getKgMid(),userid:userInfo.uid||"",uuid:KgUser.getDfid(APPINFO.APP_ID),lst:+new Date},null,!1])}),Kg.$(".listen-dialog-ft").addEvent("click",function(){downloadModule.startForAppPlay(5,"listen"),otherMode.clickReportBI("拉起播放页","点击打开收听"),checkLogCount([30050,{a:26299,b:"点击",ft:"单曲分享H5-导流弹窗",r:"单曲分享H5",mid:KgUser.getKgMid(),userid:userInfo.uid||"",uuid:KgUser.getDfid(APPINFO.APP_ID),lst:+new Date},null,!1])}),checkLogCount([30050,{a:26298,b:"曝光",ft:"单曲分享H5-导流弹窗",r:"单曲分享H5",mid:KgUser.getKgMid(),userid:userInfo.uid||"",uuid:KgUser.getDfid(APPINFO.APP_ID),lst:+new Date},null,!1])}}function showListenOutTip(){if(Kg.UA.isWeiXin){var e=new Date,a=localStorage.getItem("showListenOutTipTimes")||0,t=localStorage.getItem("lastListenOutTipCloseTime")||0,o=localStorage.getItem("lastListenOutTipShowDay")||"";o&&o==e.getMonth()+"-"+e.getDate()?console.log("today弹了"):(a<3&&t<+e-6048e5&&(Kg.$("body").append('</div><div class="listenOutTip" id="listenOutTip"></div>'),localStorage.setItem("lastListenOutTipShowDay",e.getMonth()+"-"+e.getDate())),Kg.$("#listenOutTip").addEvent("click",function(){Kg.$("#listenOutTip").hide(),a++,localStorage.setItem("showListenOutTipTimes",a),localStorage.setItem("lastListenOutTipCloseTime",+new Date),checkLogCount([30050,{a:26300,b:"点击",ft:"单曲分享H5-后台播放引导浮窗",r:"单曲分享H5",mid:KgUser.getKgMid(),userid:userInfo.uid||"",uuid:KgUser.getDfid(APPINFO.APP_ID),lst:+new Date},null,!1])}))}}var APPINFO={APP_ID:3358,CLIENT_VER:1022,APP_KEY:"aj80NzKbSoIs1CUt7QYt43bFxkdOITCn"};try{if(phpParam.song_info.data.trans_param&&null==phpParam.song_info.data.trans_param.hash_offset&&(phpParam.song_info.data.trans_param.hash_offset={start_ms:0}),"wx_music_video"==phpParam.chl2)if(Kg.UA.isWeiXin){if(Kg.UA.iphone){var ua=navigator.userAgent.toLowerCase(),version=0,micromessenger="micromessenger";if(ua.match(/MicroMessenger/i)==micromessenger){var verStr=ua.substring(ua.indexOf(micromessenger)+micromessenger.length,ua.indexOf(micromessenger)+micromessenger.length+2);version=parseInt(verStr.split("/")[1]),version<8&&(console.log("删掉 wx_music_video"),phpParam.chl2="")}}}else console.log("删掉 wx_music_video"),phpParam.chl2=""}catch(e){}var Util={paramToObj:function(e){for(var a={},t=e?e.split("&"):[],o=0,i=t.length;o<i;o++){var n=t[o].split("=");n.length>1&&(a[n[0]]=n[1])}return a},getSearch:function(){var e=location.search.split("?")[1],a={};try{a=JSON.parse(decodeURIComponent(e))}catch(e){}return a},getQueryString:function(e){var a=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(a);return null!=t?unescape(t[2]):null},parseSourceFromSearch:function(){return"/share/"===window.location.pathname||"/share/index.php"===window.location.pathname||window.location.href.indexOf("http://m.kugou.com/weixin/")>=0?"":window.location.href.indexOf("frombaidu")>-1?"frombaidu":window.location.href.indexOf("fromweixin=")>-1?"fromweixin=":window.location.href.indexOf("fromweixin")>-1?"fromweixin":window.location.href.indexOf("from_sogou")>-1?"from_sogou":window.location.href.indexOf("fromhuawei")>-1?"fromhuawei":window.location.href.indexOf("tthezuo")>-1?"tthezuo":window.location.href.indexOf("from_360")>-1?"from_360":window.location.href.indexOf("fromoppo")>-1?"fromoppo":window.location.href.indexOf("qbmini")>-1?"qbmini":"fromother"},stringfyQueryString:function(e){if(!e)return"";var a=[];for(var t in e){var o=e[t];if(o instanceof Array)for(var i=0;i<o.length;++i)a.push(encodeURIComponent(t+"["+i+"]")+"="+encodeURIComponent(o[i]));else a.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]))}return a.join("&")},formateCommentNum:function(e){return e>=1e6?"100w+":e>=1e5?parseInt(e/1e5)+"0w+":e>=1e4?parseInt(e/1e4)+"w+":e>=1e3?"999+":e}},secondShareChl=Util.getQueryString("from")||"";!secondShareChl&&Util.getQueryString("forward")&&(secondShareChl="forward");var apmCollectData=apmCollectData||[],uaResult=UAParser?new UAParser(navigator.userAgent).getResult():{};if(logCount.forward=Kg.request.search("forward")||!1,logCount.iosch=Kg.request.search("iosch")||!1,logCount.anch=Kg.request.search("anch")||!1,logCount.iosdelay=Kg.request.search("iosdelay")||!1,logCount.andelay=Kg.request.search("andelay")||!1,logCount.playType=1,logCount.launchApplication=!1,logCount.wxReady=!1,Kg.UA.iphone){var str=navigator.userAgent.toLowerCase();logCount.os=str.match(/ipad/i)?"ipad":"iphone";var ver=str.match(/cpu iphone os (.*?) like mac os/);logCount.ver=ver?ver[1].replace(/_/g,"."):0}else{logCount.os="Android";str=navigator.userAgent;var index=str.indexOf("Android");index>=0&&(logCount.ver=parseFloat(str.slice(index+8)))}if(logCount.iosch&&Kg.UA.iphone&&logCount.iosdelay&&setTimeout(function(){location.href="http://mobilelog.kugou.com/statistics.php?cmd=107&type=app&appid="+logCount.iosch+"&url=http%3A%2F%2Fitunes.apple.com%2Fcn%2Fapp%2Fku-gou-yin-le%2Fid472208016%3Fmt%3D"+(window.searchSource?window.searchDownloadChanelId.ios:"8")},1e3*Number(logCount.iosdelay)),logCount.anch&&Kg.UA.android&&logCount.andelay&&setTimeout(function(){location.href="http://downmobile.kugou.com/promote/package/download/channel="+(window.searchSource?window.searchDownloadChanelId.android:logCount.anch)},1e3*Number(logCount.andelay)),logCount.cyt1=Kg.UA.isWeiXin?"wechat":Kg.UA.isMobileQQ||Kg.UA.isMQQBrowser||Kg.UA.isQzone?"qq":Kg.UA.isQzone?"qzone":Kg.UA.isWeibo?"weibo":"其他","mpwx"==Util.getQueryString("cyt1")&&(logCount.cyt1="mpwx"),logCount.forward)LogStat({p1:"分享H5页面",p2:"单曲",name:"单曲二级分享量",type:1}),checkLogCount([logCount.BIbusiness,{b:"分享H5页访问量",share_chl:"微信",share_type:"单曲",content_id:phpParam.hash,ivar1:phpParam.from||window.searchSource,ivar3:phpParam.p_speed||""},null,!1]);else{var shareUrl=location.href.split("#")[0]+"&forward=true";dataForWeixin.url=shareUrl,checkLogCount([logCount.BIbusiness,{b:"扫码分享页访问量",share_chl:"微信",share_type:"单曲",content_id:phpParam.hash,ivar1:phpParam.from||window.searchSource,ivar3:phpParam.p_speed||""},null,!1])}if(share.resetShareData({title:dataForWeixin.title,url:dataForWeixin.url,content:dataForWeixin.desc,img:dataForWeixin.msgImg}),(Kg.UA.isMobileQQ||Kg.UA.isMQQBrowser||Kg.UA.isQzone)&&!Kg.UA.isWeiXin){var qqScript=document.createElement("script");qqScript.src="https://qzonestyle.gtimg.cn/qzone/qzact/common/share/share.js",qqScript.onload=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||setShareInfo({title:dataForWeixin.title,summary:dataForWeixin.desc,pic:dataForWeixin.msgImg,url:dataForWeixin.url,WXconfig:{swapTitleInWX:!0,appId:"",timestamp:"",nonceStr:"",signature:""}})},document.body.appendChild(qqScript)}var hexcase=0,b64pad="",reportPlayMp3=function(){Kg.loadScript("https://staticssl.kugou.com/common/js-lib/min/kg-play-stat-report.es5.min.js",{},function(){var e,a=(e=window.MutationObserver||window.WebKitMutationObserver,function(a,t){if(a&&1!==!a.nodeType)if(e){var o=new e(function(e,a){t(e)});o.observe(a,{childList:!0,subtree:!0})}else window.addEventListener&&(a.addEventListener("DOMNodeInserted",t,!1),a.addEventListener("DOMNodeRemoved",t,!1))});window.__playStatReport=new PlayStatReport({r:"单曲分享页",a:"20537",svar1:"单曲"}),a(document,function(){window.__hash&&playStatReport.injectBaseParams({hash:window.hash}),__playStatReport.startInjectStatReport()})})};window.onload=function(){var e=(new Date).valueOf();if(setTimeout(function(){logCount.isLog&&checkLogCount([logCount.business,{typeid:40311,timelength:e-logCount.fTime,state:1,para:logCount.para},null,!0]);var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://staticssl.kugou.com/collect/common/dist/js/collect-2400.js?v=2";var t=document.getElementsByTagName("script")[0];a.addEventListener("load",function(){},!1),t.parentNode.insertBefore(a,t)},20),Kg.UA.isWeiXin&&!logCount.wxReady)var a=setInterval(function(){window.wx&&(clearInterval(a),wx.ready(function(){console.log("wx.ready了"),logCount.wxReady=!0,document.getElementById("kugou").play(),reportPlayMp3()}))},100);else setTimeout(function(){reportPlayMp3()},20);setTimeout(function(){phpParam.us&&phpParam.usm&&Kg.loadScript("https://m3ws.kugou.com/static/js/share/npm/relationChain.min.js",{},function(){relationChain.init({us:phpParam.us,usm:phpParam.usm,auto:!0,geolocation:!1,refid:"",version:2});var e=relationChain.getShareUrl(dataForWeixin.url);dataForWeixin.url=e,share.resetShareData({title:dataForWeixin.title,url:dataForWeixin.url,content:dataForWeixin.desc,img:dataForWeixin.msgImg})})},50),downloadModule.checkInstalledKg()};var cookie=function(e,a){function t(){}return t.prototype.setCookie=function(e,t,o,i,n,r){var s=encodeURIComponent(e)+"="+encodeURIComponent(t);o instanceof Date&&(s+="; expires="+o.toGMTString()),i&&(s+="; path="+i),n&&(s+="; domain="+n),r&&(s+=";secure="+r),a.cookie=s},t.prototype.getCookie=function(e){var t=a.cookie,o=encodeURIComponent(e)+"=",i=t.indexOf(o),n=null;if(i>-1){var r=t.indexOf(";",i);-1==r&&(r=t.length),n=decodeURIComponent(escape(t.substring(i+o.length,r)))}return n},t.prototype.deleteCookie=function(e){this.setCookie(e,"",new Date(0))},new t}(window,document);if(window.searchSource=Util.parseSourceFromSearch(),window.searchSource){var logo=document.createElement("img");if(logo.className="logo",logo.src="https://webimg.kgimg.com/63298a8af19e61b39aa32713f705f520.png",document.body.appendChild(logo),"https:"==document.location.protocol){var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?85cd0cae296886f72cae1a333a549fe7";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)})()}else{var _bdhmProtocol="https://";document.write(unescape("%3Cscript src='"+_bdhmProtocol+"hm.baidu.com/h.js%3Fc0eb0e71efad9184bda4158ff5385e91' type='text/javascript'%3E%3C/script%3E"))}var playAudio=function(){document.querySelector("audio").play(),document.removeEventListener("touchstart",playAudio)};document.addEventListener("touchstart",playAudio)}window.searchDownloadChanelId=function(){switch(window.searchSource){case"frombaidu":return{ios:"1100",android:"376"};case"fromweixin":case"fromweixin=":return{ios:"111",android:"585"};case"from_sogou":return{ios:"1046",android:"57"};case"fromhuawei":return{ios:"",android:"370"};case"tthezuo":return{ios:"3044",android:"608"};case"from_360":return{ios:"2078",android:"610"};case"fromoppo":return{ios:"",android:"745"};case"qbmini":return{ios:"",android:"558"};default:return{ios:"",android:""}}}();var userInfo={isLogin:!1,uid:0,clienttoken:"",appid:APPINFO.APP_ID},kugou=cookie.getCookie("KuGoo"),kugouObj=Util.paramToObj(kugou);kugouObj.KugooID&&kugouObj.a_id==APPINFO.APP_ID&&(userInfo.isLogin=!0,userInfo.uid=kugouObj.KugooID,userInfo.clienttoken=kugouObj.t),function(){var e=function(){if(!(this instanceof e))return new e};e.prototype={extend:function(e,a,t){for(var o in a)t?e[o]=a[o]:e[o]||(e[o]=a[o]);return e},formatNumber:function(e){return e.toString().length<2?"0"+e:e},formatData:function(e){e=parseInt(e,10);var a=this.formatNumber(Math.floor(e/60)),t=this.formatNumber(Math.floor(e%60));return a+":"+t},addZero:function(e){return e.toString().length<=1?"0"+e:e},isIOS:function(){return!!(navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/Chrome/i))},isKnowAdr:function(){return!(!navigator.userAgent.match(/HUAWEI/i)&&!navigator.userAgent.match(/Chrome/i))},isCanPlayAudio:function(){return!!document.createElement("audio").canPlayType("audio/mpeg")},formatImgSize:function(e){size=e.size||400;var a=e.img;try{return a=a.replace(/{size}/,size),a}catch(e){return"https://m3ws.kugou.com/static/images/share2014/default_singer.png"}}};var a=function(t){var o=this;return this instanceof a?(o.utils=e(),o.init(t),this):new a(t)};a.prototype={_default:{fatherId:"player",playId:"kugou",currentTime:"current_time",totalTime:"total_time",btnPrev:"play_prev",btnNext:"play_next",btnMain:"play_main",playClass:"play",pauseClass:"pause",loadId:"loading",btnMode:"play_mode",songName:"song_name",singerName:"singer_name",singerSongName:"singer_song_name",playBarLoad:"play_bar_load",playBarPlay:"play_bar_play",songCover:"song_cover",singerCover:"singer_cover",singerCoverBg:"singer_cover_bg",defCover:"https://m3ws.kugou.com/static/images/share2014/default_singer.png",isChangeTit:!1,playBarFather:"bar",isBarMove:!1,move:!1},nextSong:function(){var e=this;curIndex=e.curIndex,e.curIndex++,e.curIndex<e.songsList.length?e.create():(e.curIndex=0,e.create())},cusLoad:function(){},cusPlay:function(){},loadStart:function(){var e=this;e.cusLoad()},playStart:function(){var e=this;e.cusPlay()},ended:function(){var e=document.getElementById(this._default.playId);e.src&&""!==e.src&&e.src},play:function(){try{clearInterval(this.playSt),clearInterval(this.loadSt)}catch(e){}var e=this,a=document;a.getElementById(e._default.playId)&&a.getElementById(e._default.playId).play()},pause:function(){var e=this,a=document;try{a.getElementById(e._default.playId).pause()}catch(e){}a.getElementById(e._default.btnMain)&&(a.getElementById(e._default.btnMain).className=e._default.playClass),a.getElementById("play_main_test")&&(a.getElementById("play_main_test").className=e._default.playClass)},setLoadProgress:function(){var e=this,a=document.getElementById(e._default.playBarLoad);if(parseInt(a.style.width,10)<99)try{var t=Math.ceil(document.getElementById(e._default.playId).duration);a.style.width=e.getCurrentBufferedTime()/t*100+"%",Math.ceil(e.getCurrentBufferedTime())>=t&&e.clearInterval(e.loadSt)}catch(e){}},setPlayProgress:function(){var e=this,a={};a=e.songsList[e.curIndex];try{document.getElementById(e._default.playBarPlay).style.width=e.getCurrentTime()/a.timeLength*100+"%"}catch(e){}},initVerifyBush:function(e,a,t){var o=window.location.href;o.indexOf("wechat_music_url")>-1&&(o=o.split("wechat_music_url")[0]),window.KgUser&&window.KgUser.antiBrushH5?KgUser.antiBrushH5({eventid:e,userid:userInfo.uid,appid:userInfo.appid,mid:a,url:o,callback:function(e){1==e.status?t&&t(e):(e&&0==e.status&&201==e.error_code&&comment.showToast("系统繁忙，请稍后再试"),e&&0==e.status&&401==e.error_code&&comment.showToast("网络异常，请稍后再试"))}}):Kg.loadScript("https://staticssl.kugou.com/common/js/min/login/kguser.v2.min.js?v=20190426",{},function(){KgUser.antiBrushH5({eventid:e,userid:userInfo.uid,appid:userInfo.appid,mid:a,url:o,callback:function(e){1==e.status?t&&t():(e&&0==e.status&&201==e.error_code&&comment.showToast("系统繁忙，请稍后再试"),e&&0==e.status&&401==e.error_code&&comment.showToast("网络异常，请稍后再试"))}})})},initSong:function(e,a){e||(e={ctype:30001}),phpParam.song_info&&phpParam.song_info.data&&phpParam.song_info.data.voice_ad&&phpParam.vip_share_activity&&(phpParam.vip_share_activity="",phpParam.vip_share_activity_voice_ad=1),11323===e.stype&&0===e.audition_status&&e.url&&(phpParam.vip_share_activity=""),phpParam.song_info&&phpParam.song_info.data&&phpParam.vip_share_activity&&"album"===phpParam.song_info.data.store_type&&(phpParam.vip_share_activity=""),11323===e.stype&&e.url&&(Kg.UA.isWeiXin||Kg.UA.isWeibo||Kg.UA.isMobileQQ)&&setTimeout(function(){showListenDialog()},1e4),11211===e.stype||11323===e.stype?(setTimeout(()=>{otherMode.init(),otherMode.secondInit(),otherMode.setFootbtn()},0),window.searchSource||advert.get_fanxing(),Kg.$("#addlike").addEvent("click",function(){downloadModule.startForAppPlay(5,"open","needfav"),otherMode.clickReportBI("拉起播放页","点击收藏歌曲")}),Kg.$("#commentIcon").addEvent("click",function(){downloadModule.openComment("cmt_more"),otherMode.clickReportBI("评论","评论按钮")}),Kg.$("#play_main_test").addEvent("click",function(){Kg.$("#play_main")[0]&&Kg.$("#play_main")[0].click()})):(Kg.$(".othermodWrap").hide(),Kg.$("#mod_down").hide(),setTimeout(()=>{otherMode.setFootbtn(1)},50)),this.initUser();var t=this,o=document,i={},n="";if(i=t.songsList[t.curIndex],phpParam.filename=e.fileName,comment.init(e),1009===e.ctype||1005===e.ctype||1===e.audition_status||11323===e.stype&&e.url){if(userInfo.isLogin&&!a){var r=KgUser.getKgMid(),s=KgUser.getPlat(userInfo.appid),d=KgUser.getDfid(userInfo.appid);return void Kg.getJSON("/api/v1/song/get_song_info_v2",{hash:i.hash,album_id:phpParam.album_id?phpParam.album_id:Kg.request.search("album_id")?Kg.request.search("album_id"):"",album_audio_id:phpParam.album_audio_id?phpParam.album_audio_id:Kg.request.search("album_audio_id")?Kg.request.search("album_audio_id"):"",cmd:"playInfo",mid:r,uid:userInfo.uid,token:userInfo.clienttoken,appid:userInfo.appid,dfid:d,platid:s,source_id:phpParam.u?phpParam.u:""},function(e,a){if(1===e.status)phpParam.song_info=e,t.initSong(phpParam.song_info.data,!0);else if(0===e.status&&1002===e.errcode){var o=a.getResponseHeader("SSA-CODE"),i=a.getResponseHeader("SSA-HMID");t.initVerifyBush(o,i,function(e){window.location.reload()})}else Kg.$("body").css({background:'#fff url("https://m3ws.kugou.com/static/images/share2014/none.png") center 40% no-repeat',"background-size":"62.5% auto"}),Kg.$("#wrap").hide(),Kg.$("#song_cover").hide(),Kg.$(".bg_mask").hide()},function(){},!0)}e,n=e.url,t.songsList[t.curIndex].src=n,t.songsList[t.curIndex].timeLength=logCount.timeLength=e.timeLength,t.songsList[t.curIndex].filename=e.fileName||unescape(i.filename),t.cover=e.album_img?e.album_img:!!e.imgUrl&&e.imgUrl;var l=0;phpParam.playbackRate=!0,phpParam.song_info.data.trans_param&&Number(phpParam.song_info.data.trans_param.display)>31&&(l=Number(phpParam.song_info.data.trans_param.display).toString(2),l=l.substr(l.length-6,1)),phpParam.song_info.data.trans_param&&"1"==l&&3===phpParam.song_info.data.trans_param.display_rate&&(phpParam.playbackRate=!1),logCount.sTime=(new Date).valueOf();var p=phpParam.song_info.data&&phpParam.song_info.data.hash,c="",u=phpParam.song_info.data&&phpParam.song_info.data.album_audio_id;n=t.songsList[t.curIndex].src;if(t.utils.isIOS()){var m=o.getElementById(t._default.playId);m.src=n,m.setAttribute("data-hash",p),m.setAttribute("data-svar2",c),m.setAttribute("data-svar3",u),m.autoplay=!0}else o.getElementById(t._default.fatherId).innerHTML='<audio id="'+t._default.playId+'" data-hash="'+p+'" data-svar2="'+c+'" data-svar3="'+u+'" src="'+n+'" controls="controls" autoplay="autoplay"></audio>',t.bindAudio();if(("1"===e.area_code||"3"===e.area_code)&&1===phpParam.song_info.data.audition_status){phpParam.vip_share_activity||!phpParam.song_info.data||phpParam.song_info.data.voice_ad||(Kg.$(".vip-dialog .vip-dialog-inner .headerBg").css("background-image","url(https://m3ws.kugou.com/static/images/single2020/icon_vip.png)"),Kg.$("#vip-dialog").show(),checkLogCount([30050,{a:27248,b:"曝光",ft:"单曲分享H5-试听弹窗",r:"单曲分享H5",mid:KgUser.getKgMid(),userid:phpParam.u||"",uuid:KgUser.getDfid(APPINFO.APP_ID),lst:+new Date},null,!1]));var g=phpParam.song_info.data.trans_param.hash_offset.start_ms/1e3;o.getElementById(t._default.playId).currentTime=g}phpParam.p_speed&&1!=Number(phpParam.p_speed)&&phpParam.playbackRate&&(o.getElementById(t._default.playId).playbackRate=Number(phpParam.p_speed),o.getElementById(t._default.playId).defaultPlaybackRate=Number(phpParam.p_speed)),window.lyric.setLyric({getInterFacePublic:window.getInterFacePublic,filename:phpParam.filename,hash:phpParam.hash,timeLength:phpParam.timelen/1e3||phpParam.song_info.data.timeLength,lyricBoxId:"lyr_box",noLycTip:"酷狗音乐，让音乐改变世界",textLycTip:"该歌词仅支持在酷狗客户端查看"}).then(function(e){window.lyrObj=e}).catch(function(e){console.log(e)});try{t.setSongHead()}catch(e){}LogStat({p1:"分享H5页面",p2:"单曲",name:"单曲-歌曲播放次数",type:4}),4==e.privilege&&LogStat({p1:"分享H5页面",p2:"单曲",name:"没下载版权歌曲页访问次数",type:1}),Kg.$("#mod_down p").show()}else 1003==e.ctype?(e,t.songsList[t.curIndex].timeLength=e.timeLength,t.songsList[t.curIndex].filename=e.fileName||unescape(i.filename),t.setSongHead(),phpParam.vip_share_activity?Kg.$("#mod_lrc .lyr_box").html('<div class="lyric_box_inner"><div class="nolrc"><p><em><i>该歌曲为付费试听歌曲</i></em></p><p><em><i>现在打开酷狗客户端享免费试听一次</i></em></p></div></div>'):Kg.$("#mod_lrc .lyr_box").html('<div class="lyric_box_inner"><div class="nolrc"><p><em><i>该歌曲付费后才能试听，</i></em></p><p><em><i>请在酷狗客户端里购买。</i></em></p></div></div>'),Kg.$("#play_main .playorpause").hide(),Kg.$("#mod_down_1").html("付费下载")):1e3==e.ctype||1001==e.ctype||1002==e.ctype||1004==e.ctype||1007==e.ctype||30001==e.ctype?(e,t.songsList[t.curIndex].timeLength=e.timeLength,t.songsList[t.curIndex].filename=e.fileName||unescape(i.filename),t.setSongHead(),Kg.$("#mod_down,#mod_lrc .morelrc,#similar_song_list,#mod_similar,#comment_scroll,#mod_singer,#mod_video,#play_main .playorpause").hide(),1007==e.ctype||30001==e.ctype?(Kg.$("#mod_lrc .lyr_box").html('<div class="lyric_box_inner"><div class="nolrc"><p><em><i>内容审核中，来酷狗听听其他歌曲吧</i></em></p></div></div>'),Kg.$("#play_main").css("marginBottom",0),Kg.$("#play_main").html('<p class="nosongImg"></p>'),Kg.$(".play_info").remove(),Kg.$(".wrap").css("background","#fff")):Kg.$("#mod_lrc .lyr_box").html('<div class="lyric_box_inner"><div class="nolrc"><p><em><i>暂无歌曲信息</i></em></p><p><em><i>先来酷狗音乐听听别的吧~</i></em></p></div></div>'),Kg.$(".wrap").css("padding-bottom","1rem")):(Kg.$("#wrap").hide(),Kg.$("#song_cover").hide(),Kg.$(".bg_mask").hide(),Kg.$("#mod_down").hide(),Kg.$("body").append('<div style="background:#323232 url(http://imge.kugou.com/h5_pic/20181115102638518229.png) center 40% no-repeat;background-size:62.5% auto;position:fixed;top:0;left:0;width:100%;height:100%;z-index:998;" ></div>'));phpParam.vip_share_activity&&(setTimeout(function(){vipShareActivityBI("23358","曝光","被分享主页面","")},50),this.showVipActivityDialog()),
"true"==Kg.request.search("nov")||window.searchSource||advert.get_Vivo(),Kg.$("#mod_down_1").addEvent("click",function(){e.btnh5=6,e.cyt2="download",downloadSong(e),otherMode.clickReportBI("拉起播放页","点击下载歌曲")}),Kg.$("#mod_down_2").addEvent("click",function(){downloadModule.startForAppPlay(5,"openAppBtn"),otherMode.clickReportBI("拉起播放页","打开酷狗")}),Kg.$("#morelrc span").addEvent("click",function(){downloadModule.startForAppPlay(5,"more_lyric"),otherMode.clickReportBI("拉起播放页","点击查看完整歌词")}),1009===e.ctype||1005===e.ctype||1===e.audition_status||11323===e.stype&&e.url?(isTest(e,1),phpParam._songStatus=1):1003==e.ctype?(isTest(e,2),phpParam._songStatus=2):1e3==e.ctype||1001==e.ctype||1002==e.ctype||1004==e.ctype?(isTest(e,3),phpParam._songStatus=3):(phpParam._songStatus=3,isTest(e,3)),"1"!==e.area_code&&"3"!==e.area_code&&(t.songsList[t.curIndex].timeLength=e.timeLength,t.songsList[t.curIndex].filename=e.fileName||unescape(i.filename),Kg.$(".mod_down").hide(),document.getElementById("kugou").pause(),setTimeout(function(){document.getElementById("kugou").pause()},5e3),Kg.$("#mod_down_1").addEvent("click",function(){downloadSong(e)}))},initUser:function(e){function a(e,a){e=e||"你的好友",a=a||"https://imgessl.kugou.com/h5_pic/20180330170534553718.jpg";var t='<div class="mod_user" id="mod_user"><div style="background-image:url('+a+')" id="mod_user_pic" class="mod_user_follow mod_user_pic"></div><div class="mod_user_box"><div id="mod_user_nickname" class="mod_user_follow username nowrap1">'+e+'</div><i id="mod_user_info">邀你一起来酷狗音乐听歌</i></div><span id="mod_user_follow" class="bannerOpenBtn">马上使用</span><span id="mod_user_open_kg" class="bannerOpenBtn mod_user_open_kg">打开酷狗</span></div>';if(Kg.$("#mod_user_area").append(t),phpParam.vip_share_activity&&(Kg.$("#mod_user_info").html("送你一次试听机会"),Kg.$("#mod_user_follow").html(phpParam.song_info.data.url?"听完整版":"免费听")),Kg.$("#mod_user_area").show(),Kg.$("#mod_content").css("padding-top","1.1rem"),Kg.$(".mod_user_follow").addEvent("click",function(){otherMode.clickReportBI("头部banner","点击好友");var e={cmd:182,jsonStr:{source:"",needfollow:!1,btnh5:7,cyt2:"banner_user",userid:phpParam.u,chl:phpParam.chl,chl2:phpParam.chl2||"",secondShareChl:secondShareChl},type:13,action:0};downloadModule.openKg(e)}),phpParam.p_speed&&"1.0"!=phpParam.p_speed&&1!=phpParam.p_speed||phpParam.p_dj||phpParam.p_flash){var o=d(),i="",n=phpParam.p_speed,r="体验一下",s=l();function d(){var e="";switch(phpParam.p_dj){case"1":e="劲爆";break;case"2":e="弹跳";break;case"3":e="慢摇";break;case"4":e="抖腿"}return e}function l(){var e="";switch(phpParam.p_flash){case"1":e="节拍";break;case"2":e="人声"}return e}phpParam.p_speed&&"1.0"!=phpParam.p_speed&&1!=phpParam.p_speed?(r="调整倍速",i="正在用<em>"+n+"倍速播放</em>这首歌"):phpParam.p_dj?i="正在用<em>一键DJ“"+o+"”</em>效果":phpParam.p_flash&&(i="正在用<em>节奏闪光“"+s+"”</em>效果"),Kg.$("#mod_user_info").html(i),Kg.$("#mod_user_follow").html(r),Kg.$(".bannerOpenBtn,#mod_user_info").addEvent("click",function(){checkLogCount([logCount.BIbusiness,{b:"点击位置",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar1:phpParam.from||window.searchSource,svar1:phpParam.eqname,ivar3:phpParam.p_speed||""},null,!1]),downloadModule.startForAppPlay(11,"mod_user_info")})}else Kg.$(".bannerOpenBtn").addEvent("click",function(){phpParam.vip_share_activity&&document.querySelector("#mod_user_area")&&document.querySelector("#mod_user_area").className.indexOf("fixedTagStatus")<=-1?(setTimeout(function(){vipShareActivityBI("23359","点击","被分享主页面","顶部banner")},50),window.myplayer.showVipActivityDialog("顶部banner")):(downloadModule.startForAppPlay(10,"use_now"),otherMode.clickReportBI("头部banner","点击马上使用"))})}if(!window.searchSource){if(phpParam.u&&phpParam.h1)var t=KgUser.getKgMid(),o=KgUser.getPlat(userInfo.appid),i=KgUser.getDfid(userInfo.appid),n={appid:userInfo.appid,clientver:"7990",clienttime:parseInt((new Date).getTime()/1e3),key:"c4dea4aa5e5bc7bb5e2892d9448b711f",uuid:"",userid:phpParam.u,mid:t,dfid:i,platid:o},r=setInterval(function(){if(logCount.wxReady||!/MicroMessenger/gi.test(window.navigator.userAgent)){function e(e){if(1===e.status&&e.data.t_nickname){window.relationuserData=e;var t={b:"曝光推广内容",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar1:phpParam.from||window.searchSource,svar1:"其他",ivar3:phpParam.p_speed||""},o=e.data.t_nickname,i=e.data.t_pic;a(o,i),checkLogCount([logCount.BIbusiness,t,null,!1])}else a()}window.relationuserData?e(window.relationuserData):Kg.Ajax({docType:"jsonp",method:"get",url:"https://relationuser.kugou.com/v1/get_userinfo",args:n,callback:function(a){e(a)},error:function(){a()}}),clearInterval(r)}},100);else a()}},showVipActivityDialog:function(e){function a(e){var a=0,t=0,o=0;e=e&&String(e);for(var i=0;i<e.length;i++)if(/[A-Za-z0-9 ]/.test(e[i])?a++:t++,o++,a+2*t>=24)return o;return o}var t=this;!e||t.hashCloseVipDialog?(e=e||"自动弹出",window.relationuserDataTryTimes||(window.relationuserDataTryTimes=0),window.relationuserDataTimer=setInterval(function(){if(!window.relationuserData&&window.relationuserDataTryTimes<=20)window.relationuserDataTryTimes++;else if(clearInterval(window.relationuserDataTimer),setTimeout(function(){vipShareActivityBI("23360","曝光","领取引导弹窗页",e)},50),document.querySelector("#vip-activity-dialog"))Kg.$("#vip-activity-dialog").show();else{var o=window.relationuserData&&window.relationuserData.data.t_nickname||"你的好友",i=phpParam.filename&&phpParam.filename.split(" - ")[1],n=a(i);i&&i.length>n&&(i=i.slice(0,n)+"...");var r=phpParam.song_info.data.audition_status?"正在试听《"+i+"》；</br>":"《"+i+"》是付费试听歌曲；",s='<div class="vip-dialog" id="vip-activity-dialog"><div class="mask"></div><div class="vip-dialog-inner"><div class="vip-activity-dialog-album"><img src="'+dataForWeixin.msgImg+'"></img></div><div class="vip-dialog-bd"><p class="vip-activity-dialog-bd-text">'+r+'<span class="nowrap1 uname"></span>送你一次免费听<span class="activeColor">完整版</span>的机会，打开APP限时领取！</p></div><div class="vip-dialog-ft" id="vip-share-btn">立即领取</div><div class="vip-dialog-tip">*请更新至最新版本，IOS端仅部分用户支持</div><div class="vip-dialog-close"></div></div></div>';Kg.$("body").append(s),document.querySelector("#vip-activity-dialog .uname").textContent="["+o+"]",Kg.$(".vip-dialog .vip-dialog-close,.vip-dialog .mask").addEvent("click",function(){Kg.$(".vip-dialog").hide(),t.hashCloseVipDialog=!0,setTimeout(function(){vipShareActivityBI("23361","点击","领取引导弹窗页","取消弹窗")},50)}),Kg.$("#vip-share-btn").addEvent("click",function(){vipShareActivityBI("23361","点击","领取引导弹窗页","立即领取"),downloadModule.startForAppPlay(5,"vipShareActivity")}),Kg.$("#vip-activity-dialog").show()}},100)):console.log("已经弹过了")},create:function(e){var a=this,t=(document,{});t=a.songsList[a.curIndex],a.utils.isCanPlayAudio()&&(a.songsList[a.curIndex].src&&""!==a.songsList[a.curIndex].src||(1===phpParam.song_info.status||30001==phpParam.song_info.errcode?a.initSong(phpParam.song_info.data,!0):0==phpParam.song_info.status&&1002==phpParam.song_info.errcode&&phpParam.song_info.data["SSA-CODE"]&&phpParam.song_info.data["SSA-HMID"]?navigator.cookieEnabled?a.initVerifyBush(phpParam.song_info.data["SSA-CODE"],phpParam.song_info.data["SSA-HMID"],function(e){window.location.reload()}):(phpParam.imgurl="",a.getSongInfoByFrontEnd(e,t)):a.getSongInfoByFrontEnd(e,t)))},getSongInfoByFrontEnd:function(e,a){var t=this;if(e)var o=setTimeout(function(){!0,logCount.isLog&&checkLogCount([logCount.business,{typeid:40315,streamid:1,timelength:-1,state:0,te:"E1",position:1,fs:1},null,!0]),t.create()},5e3);else o=null;var i=(new Date).valueOf(),n=KgUser.getKgMid(),r=KgUser.getPlat(userInfo.appid),s=KgUser.getDfid(userInfo.appid);Kg.getJSON("/api/v1/song/get_song_info_v2",{hash:a.hash,album_id:phpParam.album_id?phpParam.album_id:Kg.request.search("album_id")?Kg.request.search("album_id"):"",album_audio_id:phpParam.album_audio_id?phpParam.album_audio_id:Kg.request.search("album_audio_id")?Kg.request.search("album_audio_id"):"",cmd:"playInfo",mid:n,uid:userInfo.uid,token:userInfo.clienttoken,appid:userInfo.appid,dfid:s,platid:r,source_id:phpParam.u?phpParam.u:"",from:window.searchSource?"":"share"},function(e,a){if(e){var o=(new Date).valueOf();if(logCount.isLog&&(checkLogCount([logCount.business,{typeid:40312,timelength:o-i,state:1,para:logCount.para},null,!0]),1==e.status?checkLogCount([logCount.business,{typeid:40315,streamid:1,timelength:o-i,state:1},null,!0]):checkLogCount([logCount.business,{typeid:40315,streamid:1,timelength:o-i,state:0,te:"E2",position:1,fs:e.errcode},null,!0])),0===e.status&&1002===e.errcode){var n=a.getResponseHeader("SSA-CODE"),r=a.getResponseHeader("SSA-HMID");t.initVerifyBush(n,r,function(e){window.location.reload()})}else phpParam.song_info=e,t.initSong(phpParam.song_info.data,!0)}else Kg.$("body").css({background:'#fff url("https://m3ws.kugou.com/static/images/share2014/none.png") center 40% no-repeat',"background-size":"62.5% auto"}),Kg.$("#wrap").hide(),Kg.$("#song_cover").hide(),Kg.$(".bg_mask").hide()},function(){clearTimeout(o),logCount.isLog&&checkLogCount([logCount.business,{typeid:40315,streamid:1,timelength:-1,state:0,te:"E3",position:1,fs:502},null,!0])},!0)},setSongHead:function(){if(phpParam.song_info&&phpParam.song_info.data){var e=this,a=document,t="",o="",i={},n=[];if(i=e.songsList[e.curIndex],i.filename&&(i.filename.split(/ - /).length>1?(n=i.filename.split(/ - /),t=n[0],o=n[1]):i.filename.split(/\s?-\s?/).length>1?(n=i.filename.split(/\s?-\s?/),t=n[0],o=n[1]):o=i.filename),e.songname=o,i.timeLength,t?a.getElementById(e._default.singerName)&&(a.getElementById(e._default.singerName).innerHTML=t):a.getElementById(e._default.singerName).innerHTML="未知歌手",o&&a.getElementById(e._default.songName)&&(a.getElementById(e._default.songName).innerHTML=o),phpParam.song_info.data&&1==+phpParam.song_info.data.publish_self_flag&&(Kg.$("#selfpublish").show(),document.querySelector("#selfpublish").style.display="block",document.querySelector("#play_song_w").style.maxWidth="40%"),"undefined"==typeof fmtypeimg||"-1"==fmtypeimg?{singerName:t.split("、")[0],size:400}:{hash:i.hash,fmtype:fmtypeimg},!phpParam.imgurl){var r=e.cover?replaceHttpsImg(e.cover):"https://m3ws.kugou.com/static/images/share2014/default_singer.png",s=e.utils.formatImgSize({img:r});a.getElementById(e._default.songCover).style.backgroundImage="url("+s+")",a.getElementById(e._default.singerCoverBg).src=s,dataForWeixin&&(dataForWeixin.msgImg=s)}}},getBufferedTime:function(){var e=this,a={};a=e.songsList[e.curIndex];var t=Math.ceil(e.getCurrentBufferedTime());return t>a.timeLength&&(t=a.timeLength),t},getPlayTime:function(e){var a=this,t={};t=a.songsList[a.curIndex];var o=e||Math.ceil(a.getCurrentTime());t&&o>t.timeLength&&(o=t.timeLength);var i=Math.floor(o/60),n=o%60;return a.utils.addZero(i)+":"+a.utils.addZero(n)},getCurrentTime:function(){try{return document.getElementById(this._default.playId).currentTime}catch(e){}return 0},getCurrentBufferedTime:function(){try{return document.getElementById(this._default.playId).buffered.end(0)}catch(e){}return 0},addSongsAndPlay:function(e){var a=this;e&&(e.write?a.songsList=e.songs:a.songsList=a.songsList.concat(e.songs),a.pause(),a.create(!0))},bindAudio:function(){function e(e){var a=i.getElementById(o._default.playId).currentTime;if(a=Math.floor(1e3*a),o.playCollectObj.noReportSumTime||(o.playCollectObj.noReportSumTime=0),o.playCollectObj.lastRecodeTime||(o.playCollectObj.lastRecodeTime=0),!o.playCollectObj.played&&o.playCollectObj.noReportSumTime>1e3&&(o.playCollectObj.played=!0,e="init"),a-o.playCollectObj.lastRecodeTime<-2e3)return o.playCollectObj.played=!1,o.playCollectObj.noReportSumTime>0&&t(o.playCollectObj.noReportSumTime),o.playCollectObj.noReportSumTime=0,void(o.playCollectObj.lastRecodeTime=0);a-o.playCollectObj.lastRecodeTime<1e3&&(o.playCollectObj.noReportSumTime+=a-o.playCollectObj.lastRecodeTime),o.playCollectObj.lastRecodeTime=a,(o.playCollectObj.noReportSumTime>=1e4||e&&o.playCollectObj.noReportSumTime>=1e3)&&("init"==e?(o.playCollectObj.noReportSumTime-=1e3,t(1e3)):(t(o.playCollectObj.noReportSumTime),o.playCollectObj.noReportSumTime=0)),"end"==e&&(o.playCollectObj.played=!1)}function a(){if(null!=this.spiderFs)return this.spiderFs;var e="0",a=navigator.userAgent;return a&&a.search(/spider/i)>-1?(e=a.search(/Baiduspider/i)>-1?"Baiduspider":a.search(/Bytespider/i)>-1?"Bytespider":"Otherspider",this.spiderFs=e,e):(this.spiderFs=e,e)}function t(e){var t={a:27812,b:"统计",r:"官网播放统计",ft:2,mid:KgUser&&KgUser.getKgMid()||"",userid:userInfo&&userInfo.uid||"0",fo:document.referrer,svar1:location.href,svar2:e,svar3:phpParam.song_info&&phpParam.song_info.data&&phpParam.song_info.data.album_audio_id||phpParam.album_audio_id||"",svar4:a(),hash:phpParam.song_info&&phpParam.song_info.data&&phpParam.song_info.data.hash||phpParam.hash||""};checkLogCount([30050,t,null,!1])}var o=this,i=document,n=!1,r=navigator.userAgent;Kg.$("#"+o._default.playId).addEvent("canplay",function(){showListenOutTip(),logCount.isF&&(logCount.isLog&&(logCount.eTime=(new Date).valueOf(),checkLogCount([logCount.business,{typeid:40301,timelength:logCount.eTime-logCount.sTime,state:1,para:logCount.para},null,!0]),checkLogCount([logCount.business,{typeid:40313,timelength:logCount.eTime-logCount.fTime,state:1,para:logCount.para},null,!0])),logCount.isF=!1),navigator.userAgent.match(/UCBrowser/i)||Kg.UA.isWeibo?o.getCurrentTime()>0&&o.playStart():o.playStart()}),Kg.$("#"+o._default.playId).addEvent("ended",function(){e("end")}),Kg.$("#"+o._default.playId).addEvent("waiting",function(){logCount.isLog&&logCount.cnt<2&&(logCount.cnt++,checkLogCount([logCount.business,{typeid:40303,buf_cnt:logCount.cnt,state:1,para:logCount.para},null,!0]))}),Kg.$("#"+o._default.playId).addEvent("pause",function(){clearInterval(window.zhizhenanimaTimer),Kg.$("#play_main").attr("deg",""),o.playStart(),o.pause(),o.playCollect("pause")}),Kg.$("#"+o._default.playId).addEvent("play",function(){o.play(),window.zhizhenanimaTimer=setInterval(function(){var e=Kg.$("#play_main").attr("deg");12==e?Kg.$("#play_main").attr("deg","11"):Kg.$("#play_main").attr("deg","12")},1500),logCount.isLog&&!logCount.played&&(logCount.played=!0,checkLogCount([logCount.business,{typeid:40302,buf_cnt:0,state:1,para:logCount.para},null,!0]))}),Kg.$("#"+o._default.playId).addEvent("error",function(e){var a=this;if(a.src===phpParam.song_info.data.url&&phpParam.song_info.data.backup_url.length)return window.audioCurrentTime=a.currentTime,a.src=phpParam.song_info.data.backup_url[0],a.play(),void(a.currentTime=window.audioCurrentTime);if(logCount.isLog&&logCount.isF){function t(){var e="",t=navigator.userAgent;return t&&t.search(/spider/i)>-1?(e=t.search(/Baiduspider/i)>-1?"Baiduspider":t.search(/Bytespider/i)>-1?"Bytespider":"Otherspider",e):a.error.code}checkLogCount([logCount.business,{typeid:40301,timelength:0,state:0,fs:t(),para:logCount.para,para1:{filename:phpParam.filename,url:phpParam.song_info.data.url,locationHref:window.location.href,errorcode:a.error.code,errormessage:a.error.message}},null,!0]),logCount.isF=!1}a=this;try{switch(a.error.code){case 1:case 2:case 3:break;case 4:r.match(/iPad|iPhone|iPod/i)||r.match(/Android|Adr/i)}}catch(e){}o.playStart()}),Kg.$("#"+o._default.playId).addEvent("playing",function(){o.play()});var s=!0,d={b:"播放",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,content_id:phpParam.album_audio_id||"",svar1:"",ivar1:phpParam.from||window.searchSource,ivar3:phpParam.p_speed||""};phpParam.song_info&&phpParam.song_info.data&&1003==phpParam.song_info.data.ctype&&phpParam.song_info.data.url&&(phpParam.song_info.data.voice_ad?d.svar1="11":d.svar1="1"),phpParam.u&&(d.user_id=phpParam.u),Kg.$("#"+o._default.playId).addEvent("timeupdate",function(){if("1"===phpParam.song_info.data.area_code||"3"===phpParam.song_info.data.area_code){if(document.getElementById(o._default.playId).paused?(i.getElementById(o._default.btnMain)&&(i.getElementById(o._default.btnMain).className=o._default.playClass),i.getElementById("play_main_test")&&(i.getElementById("play_main_test").className=o._default.playClass)):(i.getElementById(o._default.btnMain)&&(i.getElementById(o._default.btnMain).className=o._default.pauseClass),i.getElementById("play_main_test")&&(i.getElementById("play_main_test").className=o._default.pauseClass)),phpParam.song_info.data.trans_param&&1===phpParam.song_info.data.audition_status){var a=phpParam.song_info.data.trans_param.hash_offset.start_ms/1e3;o.getCurrentTime()<a&&(i.getElementById(o._default.playId).currentTime=a)}phpParam.playbackRate&&phpParam.p_speed&&1!=Number(phpParam.p_speed)&&s&&Kg.UA.iphone&&!iOS9()&&(s=!1,document.getElementById("kugou").playbackRate=Number(phpParam.p_speed),document.getElementById("kugou").defaultPlaybackRate=Number(phpParam.p_speed));var t=o.getCurrentTime(),r=t/logCount.timeLength;window.lyrObj&&window.lyrObj.updateLyrIndex(t),e(),1===logCount.playType&&t>1&&r<.98?(logCount.playType=2,d.b="播放",checkLogCount([logCount.BIbusiness,d,null,!1])):2===logCount.playType&&r>.98&&(logCount.playType=1,d.b="完整播放",checkLogCount([logCount.BIbusiness,d,null,!1])),navigator.userAgent.match(/UCBrowser/i)||Kg.UA.isWeibo?o.getCurrentTime()>0&&o.playStart():o.playStart(),o._default.isBarMove||i.getElementById(o._default.currentTime)&&(i.getElementById(o._default.currentTime).innerHTML=o.getPlayTime()),n||(n=!0)}else document.getElementById("kugou").pause()}),Kg.$("#"+o._default.playId).addEvent("loadstart",function(){o.loadStart()}),Kg.$("#"+o._default.playId).addEvent("suspend",function(){o.playStart()}),Kg.$("#"+o._default.playId).addEvent("loadeddata",function(){}),o.playCollect=e,o.playCollectObj={}},selfpublish:function(){Kg.$("#selfpublish").addEvent("click",function(){checkLogCount([logCount.BIbusiness,{a:22495,b:"点击",ft:"自助发行按钮",r:"单曲分享H5页面",svar4:phpParam.hash,userid:phpParam.u,mid:KgUser.getKgMid()},null,!1]),setTimeout(function(){window.location.href="https://h5.kugou.com/apps/musician-enter/build/index.html"},500)})},bind:function(){var e=this,a=document;a.getElementById(e._default.btnMain)&&(Kg.$("#"+e._default.btnMain).addEvent("click",function(){return e.songsList&&e.songsList.length>0&&(this.className.indexOf(e._default.playClass)>-1?(e.getCurrentTime()<1&&e.loadStart(),e.play(),LogStat({p1:"分享H5页面",p2:"单曲",name:"播放按钮点击量",type:1}),checkLogCount([30050,{a:28155,b:"点击",ft:"单曲分享H5",r:"分享",mid:KgUser.getKgMid(),userid:phpParam.u,svar1:"播放"},null,!1])):(e.pause(),LogStat({p1:"分享H5页面",p2:"单曲",name:"暂停按钮点击量",type:1}),checkLogCount([30050,{a:28155,b:"点击",ft:"单曲分享H5",r:"分享",mid:KgUser.getKgMid(),userid:phpParam.u,svar1:"暂停"},null,!1]))),phpParam.vip_share_activity&&(e.showVipActivityDialog("唱片区域"),setTimeout(function(){vipShareActivityBI("23359","点击","被分享主页面","唱片区域")},50)),phpParam.song_info&&phpParam.song_info.data&&!phpParam.song_info.data.url&&downloadModule.startForAppPlay(5,"open"),!1}),Kg.$("#play_main").show()),e.bindAudio(),e.selfpublish()},init:function(e){var a=this;return a.songsList=[],a.curIndex=0,e&&a.utils.extend(a._default,e,!0),a.bind(),this}},window.Player=a}();var iOS9=function(){var e,a=navigator.userAgent.toLowerCase();if(a.indexOf("like mac os x")>0){var t=/os [\d._]*/gi,o=a.match(t);e=(o+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,".")}var i=e+"";return"undefined"!=i&&i.length>0&&Number(e.substring(0,2))>=9},downloadModule=function(e){function a(e){var a=null,t=!1,o=0;a=window.setInterval(function(){o++,t=document.hidden||document.webkitHidden,(t||o>4)&&(e(t),clearInterval(a))},50)}function t(){e.UA.isMobileQQ&&e.UA.android&&e.loadScript("https://m3ws.kugou.com/static/js/share/npm/qqapi.min.js",{},function(){window.mqq&&window.mqq.invoke("app","checkAppInstalledAuthorized",{packageName:"com.kugou.android",businessName:"m.kugou.com"},function(e){console.log("checkkg",e&&e.info),e&&e.info&&parseInt(e.info)>0&&(window.hashInstalledKg=!0)})})}function o(a){a=a||(e.UA.iphone?"ios":e.UA.android?"android":"");var t=Util.getQueryString("ioschannel"),o=Util.getQueryString("androidchannel");return"android"===a&&o?"http://downmobile.kugou.com/promote/package/download/channel="+o:!("ios"!==a||!t)&&"http://mobilelog.kugou.com/statistics.php?cmd=107&type=app&appid="+t+"&url="+encodeURIComponent("https://itunes.apple.com/app/apple-store/id472208016?pt=624347&ct=gqbfldy&mt=8")}function i(t){var o="kugou://start.weixin"+(t?"?"+t:""),i=sourceMap[source]&&sourceMap[source].android||(window.searchSource?"http://downmobile.kugou.com/promote/package/download/channel="+window.searchDownloadChanelId.android:"http://mo.kugou.com/download/app/index.php"),n=document.createElement("iframe");n.style.width="1px",n.style.height="1px",n.style.display="none",n.src=o,document.body.appendChild(n),window.hashInstalledKg||setTimeout(function(){window.isHiddenTime&&+new Date-window.isHiddenTime<5e3?console.log("有拉起过了"):a(function(a){a||(console.log("客户端下载地址",i),e.UA.isWeibo?location.href="http://downmobile.kugou.com/promote/package/download/channel="+("sina"==phpParam.chl?"518":"271"):location.href=i)})},10)}function n(t){var o=(navigator.userAgent.match(/iPad/i)?"kugouurlhd://start.weixin":"kugouurl://start.weixin")+(t?"?"+t:""),i=sourceMap[source]&&sourceMap[source].ios||(navigator.userAgent.match(/iPad/i)?"https://itunes.apple.com/cn/app/%E9%85%B7%E7%8B%97%E9%9F%B3%E4%B9%90hd/id657285176?l=en&mt="+(window.searchSource?window.searchDownloadChanelId.ios:"8"):window.searchSource?"http://itunes.apple.com/cn/app/ku-gou-yin-le/id472208016?mt="+window.searchDownloadChanelId.ios:"http://mo.kugou.com/download/app/index.php");(new Date).valueOf();location.href=o,setTimeout(function(){window.isHiddenTime&&+new Date-window.isHiddenTime<5e3?console.log("有拉起过了"):a(function(a){a||(console.log("客户端下载地址",i),location.href=e.UA.isWeibo||e.UA.isMobileQQ?"http://itunes.apple.com/cn/app/ku-gou-yin-le/id472208016":i)})},10)}function r(e,a,t){try{if(!phpParam||!phpParam.song_info||!phpParam.song_info.data)return void downloadModule.openKg({cmd:"",jsonStr:{}},"");var o="";["vipShareActivity","openAppBtn"].indexOf(a)>-1&&(o=phpParam.vip_share_activity||phpParam.vip_share_activity_voice_ad||"");var i={cmd:212,jsonStr:{hash:phpParam.hash,filename:unescape(phpParam.filename),bitrate:phpParam.song_info.data.bitRate||0,duration:phpParam.song_info.data.timeLength||0,extname:phpParam.song_info.data.extName||0,privilege:phpParam.song_info.data.privilege||"","320privilege":phpParam.song_info.data["320privilege"]||"",sqprivilege:phpParam.song_info.data.sqprivilege||"",album_audio_id:phpParam.song_info.data.album_audio_id||"",trans_param:phpParam.song_info.data.trans_param||"",needfav:!!t,btnh5:e,cyt2:a,userid:phpParam.u,chl:phpParam.chl,chl2:phpParam.chl2||"",secondShareChl:secondShareChl,vip_share_activity:o},type:1,action:1}}catch(e){console.log(e)}phpParam.eqid&&1==phpParam.fromeq&&(i.jsonStr.eqid=phpParam.eqid,i.jsonStr.needfav=!1,i.action=5),phpParam.eqname&&(i.jsonStr.eqname=phpParam.eqname),phpParam.eqtype&&(i.jsonStr.eqtype=phpParam.eqtype),phpParam.eqdata&&(i.jsonStr.eqdata=phpParam.eqdata),phpParam.nickname&&(i.jsonStr.eqnickname=phpParam.nickname),phpParam.p_dj&&(i.jsonStr.viperdj=parseInt(phpParam.p_dj)),phpParam.p_flash&&(i.jsonStr.viperflash=parseInt(phpParam.p_flash)),phpParam.p_speed&&(i.jsonStr.p_speed=phpParam.p_speed),downloadModule.openKg(i,"")}function s(a,t){var r=window.searchDownloadChanelId,s=o();if(s)location.href=s;else if(logCount.iosch&&e.UA.iphone)location.href="http://mobilelog.kugou.com/statistics.php?cmd=107&type=app&appid="+logCount.iosch+"&url=http%3A%2F%2Fitunes.apple.com%2Fcn%2Fapp%2Fku-gou-yin-le%2Fid472208016%3Fmt%3D"+(r.ios?r.ios:"8");else if(logCount.anch&&e.UA.android)location.href="http://downmobile.kugou.com/promote/package/download/channel="+(r.ios?r.android:logCount.anch);else{var d=getSource();if(d&&a&&a.jsonStr&&(a.jsonStr.hreffrom=d),checkLogCount(""==t?[logCount.BIbusiness,{b:"点击触发拉起客户端",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar2:logCount.os,svar2:logCount.ver,ivar3:phpParam.p_speed||""},null,!1]:[logCount.BIbusiness,{b:"点击触发拉起客户端",share_chl:_chl,share_type:t,hash:phpParam.hash,ivar2:logCount.os,svar2:logCount.ver,ivar3:phpParam.p_speed||""},null,!1]),phpParam.mdli&&(a.jsonStr.mdli=phpParam.mdli),phpParam.u&&phpParam.h1&&(a.jsonStr.u=phpParam.u,a.jsonStr.h1=phpParam.h1),phpParam.h2&&(a.jsonStr.h2=phpParam.h2),window.searchSource?a.jsonStr.pull_channel_id=window.searchSource:a.jsonStr.cyt1=logCount.cyt1,console.log("openKg",a),e.UA.isWeiXin&&wx.invoke&&c(navigator.userAgent.match(/MicroMessenger\/([\d\.]+)/i)[1],"6.5.16"))l(a);else if(!iOS9()||!a.type||e.UA.isWeibo||e.UA.isMobileQQ){var p=JSON.stringify({cmd:a.cmd,jsonStr:a.jsonStr});if(e.UA.android&&(e.UA.isMobileQQ||e.UA.isMQQBrowser||e.UA.isQzone))if(e.UA.isMobileQQ)i(p);else{var u=encodeURIComponent("kugou://start.weixin"+(p?"?"+p:"")),m=appURL||"http://a.app.qq.com/o/simple.jsp?pkgname=com.kugou.android&ckey=CK1322657065855";setTimeout(function(){location.href=partnerApp.openUrl(m+"&android_schema="+u+"&schema_version=7950")},100)}else e.UA.isWeiXin?e.$("#pop_mask").show():e.UA.iphone?n(p):e.UA.android&&i(p)}else{var g=navigator.userAgent.match(/iPad/i)?"https://mos.kugou.com/universal/":"https://mo.kugou.com/universal/";setTimeout(function(){location.href=g+"?Type="+a.type+"&Action="+a.action+"&Json="+encodeURIComponent(JSON.stringify(a.jsonStr))+"&channel="+(window.searchSource?window.searchDownloadChanelId.ios:"t001")},100)}}}function d(e){checkLogCount([logCount.BIbusiness,{b:"点击触发拉起客户端",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar2:logCount.os,svar2:logCount.ver,ivar3:phpParam.p_speed||""},null,!1]),checkLogCount([logCount.BIbusiness,{b:"点击位置",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar1:phpParam.from||window.searchSource,svar1:"评论",ivar3:phpParam.p_speed||""},null,!1]);var a={cmd:399,jsonStr:{pageType:1,commentType:1,hash:phpParam.hash,childrenId:comment.childrenid,childrenName:unescape(phpParam.filename),cover:phpParam.imgurl,btnh5:3,cyt2:e,userid:phpParam.u,chl:phpParam.chl,chl2:phpParam.chl2||"",secondShareChl:secondShareChl}};this.openKg(a)}function l(a,t){try{var o={is_start_weixin:!0,real_content:"kugou://start.weixin?"+JSON.stringify(a)};a.jsonStr.userid=a.jsonStr&&a.jsonStr.userid||phpParam.u,a.jsonStr.chl=phpParam.chl,a.jsonStr.chl2=phpParam.chl2||"",a.jsonStr.secondShareChl=secondShareChl,setTimeout(function(){wx.invoke("launchApplication",{appID:"wx79f2c4418704b4f8",parameter:"kugouurl://start.weixin?"+encodeURIComponent(JSON.stringify(a)),extInfo:"kugouURL://start.fanxing?"+encodeURIComponent(JSON.stringify(o))},function(a){"launchApplication:ok"===a.err_msg?(console.log("launchApplication:ok"),checkLogCount([logCount.BIbusiness,{b:"拉起客户端接口调用结果",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar1:phpParam.from||window.searchSource,svar1:"成功",ivar3:phpParam.p_speed||""},null,!1])):"launchApplication:fail"===a.err_msg?(console.log("launchApplication:fail"),window.wx_launchApplication_fail=!0,checkLogCount([logCount.BIbusiness,{b:"拉起客户端接口调用结果",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar1:phpParam.from||window.searchSource,svar1:"失败-跳转下载页",ivar3:phpParam.p_speed||""},null,!1]),setTimeout(function(){if(!t)return e.UA.android&&source?(console.log("客户端下载地址",sourceMap[source]&&sourceMap[source].android),void(window.location.href=sourceMap[source]&&sourceMap[source].android||partnerApp.openUrl("http://a.app.qq.com/o/simple.jsp?pkgname=com.kugou.android&ckey=CK1322657065855"))):e.UA.iphone&&source?(console.log("客户端下载地址",sourceMap[source]&&sourceMap[source].ios),void(window.location.href=sourceMap[source]&&sourceMap[source].ios||"https://itunes.apple.com/app/apple-store/id472208016?pt=624347&ct=schoolstar&mt=8")):void(e.UA.android?window.location.href=partnerApp.openUrl("http://a.app.qq.com/o/simple.jsp?pkgname=com.kugou.android&ckey=CK1322657065855"):e.UA.iphone?window.location.href="https://itunes.apple.com/app/apple-store/id472208016?pt=624347&ct=schoolstar&mt=8":window.location.href="http://mo.kugou.com/download/app/index.php")},100)):(console.log(a.err_msg+"  launchApplication-未知失败"),checkLogCount([logCount.BIbusiness,{b:"拉起客户端接口调用结果",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar1:phpParam.from||window.searchSource,svar1:"失败-弹提示窗",ivar3:phpParam.p_speed||""},null,!1]),e.$("#pop_mask").show())})},100)}catch(e){console.log("error",e)}}var p,c=function(e,a){var t=parseFloat(e),o=parseFloat(a),i=e.replace(t+".",""),n=a.replace(o+".","");return t>o||!(t<o)&&i>=n};return{openKg:s,openComment:d,startForAppPlay:r,downkey:p,compareVersion:c,checkInstalledKg:t}}(Kg),comment={loaded:!1,loading:!1,count:0,now:0,$content:Kg.$("#mod_content"),$comment:Kg.$("#mod_comment"),$btn:Kg.$("#comment span"),$commentLoding:Kg.$("#comment_loading"),hash:phpParam.hash||Kg.request.search("hash"),$toast:Kg.$("#toast"),code:"fc4be23b4e972707f36b8a828a93ba8a",logined:!1,scrollTimer:!1,showToast:function(e){var a=this;a.timer&&window.clearInterval(a.timer),a.$toast.html(e).show(),a.timer=setTimeout(function(){a.$toast.hide()},3e3)},loadComment:function(){var e=this;e.loading=!0,e.$commentLoding.show(),e.logined=e.checkCookie(),Kg.$("#comment_scroll_tag").show(),Kg.Ajax({method:"get",url:"https://mcomment.kugou.com/index.php",args:{r:"commentsv2/getCommentWithLike",code:e.code,extdata:e.hash,p:1,pagesize:10,kugouid:e.logined?e.kugouC.KugooID:"",clienttoken:e.logined?e.kugouC.t:""},callback:function(a){if("string"==typeof a&&(a=JSON.parse(a)),e.$commentLoding.hide(),a&&a.childrenid&&(e.childrenid=a.childrenid),1==a.status&&"success"==a.msg&&a.count>0){function t(){var e=document.querySelector("#comment_scroll").offsetTop+document.querySelector("#mod_vivo").offsetHeight;window.scrollY+window.innerHeight>=e&&!comment.hashReportComment&&(console.log("评论曝光"),comment.hashReportComment=!0,checkLogCount([logCount.BIbusiness,{b:"曝光评论页",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar1:phpParam.from||window.searchSource,ivar3:phpParam.p_speed||""},null,!1]))}Kg.$(document).addEvent("scroll",t),Kg.$("#commentIcon")&&Kg.$("#commentIcon span").addClass("hashCount"),Kg.$("#commentIcon")&&Kg.$("#commentIcon strong").html(Util.formateCommentNum(a.count));var o="",i="";if(a.weightList.length>0)for(var n=a.weightList.length>3?3:a.weightList.length,r=0;r<n;r++){var s=replaceHttpsImg(a.weightList[r].user_pic)||"https://m3ws.kugou.com/static/images/single2020/singer_default.png";o+='<li><i lang="'+a.weightList[r].id+'"  '+(a.weightList[r].like.haslike?'class="liked"':"")+" >"+a.weightList[r].like.count+'</i><div class="comment_img" style="background-image:url('+s+')" uid="'+a.weightList[r].user_id+'" ></div><div class="authorWrap"><h6 uid="'+a.weightList[r].user_id+'" >'+a.weightList[r].user_name+"</h6><span>"+a.weightList[r].addtime.substring(0,10)+"</span></div><p><em>"+a.weightList[r].content+"</em></p></li>",i+=a.weightList[r].id+",",e.now++}if(a.list.length>0&&e.now<3)for(r=0;r<a.list.length;r++){if(i.indexOf(a.list[r].id)<0){s=replaceHttpsImg(a.list[r].user_pic)||"https://m3ws.kugou.com/static/images/single2020/singer_default.png";o+='<li><i lang="'+a.list[r].id+'"  '+(a.list[r].like.haslike?'class="liked"':"")+">"+a.list[r].like.count+'</i><div class="comment_img" style="background-image:url('+s+')" uid="'+a.list[r].user_id+'" ></div><div  class="authorWrap"><h6 uid="'+a.list[r].user_id+'"   >'+a.list[r].user_name+"</h6><span>"+a.list[r].addtime.substring(0,10)+"</span></div><p><em>"+a.list[r].content+"</em></p></li>",e.now++}if(e.now>=3)break}o?(Kg.$("#comment_more").html("查看全部 "+a.count+" 条评论").show(),Kg.$("#comment_content h4").show(),Kg.$("#comment_content ul").html(o),e.checkComment("comment_content"),Kg.$("#comment_content p").addEvent("click",function(){e.closeComment()}),Kg.$("#comment_content i").addEvent("click",function(){otherMode.clickReportBI("评论","点赞评论");var a=Kg.$(this);e.like(a.attr("lang"),a)}),Kg.$("#comment_content .comment_img").addEvent("click",function(){var a=Kg.$(this);otherMode.clickReportBI("评论","评论列表头像"),a.attr("uid")&&e.toUser(a.attr("uid"),8,"cmtavatar")}),Kg.$("#comment_content h6").addEvent("click",function(){var a=Kg.$(this)
;otherMode.clickReportBI("评论","评论列表名称"),a.attr("uid")&&e.toUser(a.attr("uid"),9,"cmtname")}),Kg.$(".comment_more").show(),Kg.$("#comment_more").addEvent("click",function(){otherMode.clickReportBI("评论","查看全部评论"),downloadModule.openComment("cmt_more")})):e.noComment()}else e.noComment();e.loading=!1,e.loaded=!0},error:function(){e.closeComment(),e.$commentLoding.hide(),e.showToast("网络错误")}})},toComment:function(){var e=this;e.times=0,clearTimeout(e.scrollTimer);var a=(pageHeight-window.scrollY)/15;e.scrollTo(window.scrollY,a)},scrollTo:function(e,a){var t=this;t.scrollTimer=setTimeout(function(){t.times<15?(t.times++,window.scrollTo(0,e+t.times*a),t.scrollTo(e,a)):t.times=0},20)},toUser:function(e,a,t){var o={cmd:182,jsonStr:{source:"",btnh5:a,cyt2:t,needfollow:!1,userid:e,chl:phpParam.chl,chl2:phpParam.chl2||"",secondShareChl:secondShareChl},type:13,action:0};downloadModule.openKg(o,"")},closeComment:function(){},noComment:function(){Kg.$("#noComment").show(),Kg.$("#noComment").addEvent("click",function(){otherMode.clickReportBI("评论","暂无评论按钮"),downloadModule.openComment("cmt_noComment")})},checkComment:function(e){var a=Kg.$("#"+e+" p");a.each(function(){if(this.clientHeight<this.childNodes[0].offsetHeight){var e=Kg.$(this.parentNode);e.append('<p class="all"><b>查看全文</b></p>');var a=e.find(".all");a.addEvent("click",function(){otherMode.clickReportBI("评论","查看全文"),downloadModule.openComment("cmt_fullText")})}})},checkCookie:function(){var e=this,a=Kg.Cookie.read("KuGoo");return e.kugouC=(new Kg.Param).parse(a),!!e.kugouC.KugooID},like:function(e,a){downloadModule.openComment("cmt_like")},init:function(e){var a=this;a.songData=e}},myplayer=Player({songName:"play_song",singerName:"play_singer"}),advert={isFirst:!0,roomId:"",fxTimer:"",mUrl:"",$node:Kg.$("#mod_advertisement"),advertisementType:"ktv",get_Vivo:function(){var e=this;LogStat({p1:"分享H5页面",p2:"单曲",name:"请求VIVO广告接口",type:1});var a=setInterval(function(){!logCount.wxReady&&/MicroMessenger/gi.test(window.navigator.userAgent)||(Kg.Ajax({docType:"jsonp",method:"get",url:"https://adservice.kugou.com/v1/mobile_share",args:{type:1,appid:2548,d:Math.random()},callback:function(a){a&&a.data&&a.data[0]&&a.data[0].rowid&&(e.rowid=a.data[0].rowid),1==a.status&&(Kg.$("#img_vivo").addEvent("load",function(){function t(){var a=document.querySelector("#comment_scroll").offsetTop+document.querySelector("#mod_vivo").offsetTop;if(window.scrollY+window.innerHeight>=a&&!advert.hashReportAdVIVO){if(document.hidden||document.webkitHidden)return;console.log("广告曝光"),advert.hashReportAdVIVO=!0,LogStat({p1:"分享H5页面",p2:"单曲",name:"VIVO广告曝光量",type:1}),e.statAdReport("expose",{ad_id:e.rowid})}}setTimeout(function(){t()},2e3),setTimeout(function(){otherMode.updateModeOffsetTop()},100),Kg.$(document).addEvent("scroll",t),Kg.$("#close_vivo").addEvent("click",function(e){similarType=!0,Kg.stopEvent(e),LogStat({p1:"分享H5页面",p2:"单曲",name:"关闭VIVO广告点击量",type:1}),Kg.$("#mod_vivo").hide(),otherMode.updateModeOffsetTop()}),Kg.$("#mod_vivo").show().addEvent("click",function(){e.statAdReport("click",{ad_id:e.rowid}),setTimeout(function(){location.href=a.data[0].link},200)}),document.title=document.title+" "+a.data[0].text,dataForWeixin&&(dataForWeixin.title=document.title)}),a.data[0].image&&LogStat({p1:"分享H5页面",p2:"单曲",name:"拿到VIVO广告图片URL",type:1}),Kg.$("#img_vivo").attr("src",a.data[0].image))}}),clearInterval(a))},100)},get_fanxing:function(){var e=this;Kg.Ajax({docType:"jsonp",method:"get",url:"https://fxsong.kugou.com/mobqueryV2",args:{songName:myplayer.songname,format:"jsonp"},callback:function(a){1===a.status&&a.data[0].roomId?(LogStat({p1:"分享H5页面",p2:"单曲",name:"繁星广告曝光量",type:1}),checkLogCount([30050,{a:28156,b:"曝光",ft:"单曲分享H5",r:"分享",mid:KgUser.getKgMid(),userid:phpParam.u,svar1:"直播"},null,!1]),e.roomId=a.data[0].roomId,e.mUrl="http://mfanxing.kugou.com/staticPub/mobile/sharePage/normalRoom/views/index.html?roomId=",iOS9()&&(e.mUrl="https://fxapplinks.kugou.com/staticPub/mobile/fxlinks/index.html?fromType=kugou&action=openLive&roomId="),(Kg.UA.isWeiXin||Kg.UA.isMobileQQ||Kg.UA.isQzone)&&Kg.UA.android&&(e.mUrl="http://a.app.qq.com/o/simple.jsp?pkgname=com.kugou.android&android_schema="+encodeURIComponent("kugou://start.fanxing?type=0&enterroomsource=301&roomid=")),e.show_fangxing(replaceHttpsImg(a.data[0].imgPath))):(e.$node.hide(),e.show_ktv()),e.fxTimer=setTimeout(function(){e.get_fanxing()},3e4)}}),this.isFirst&&(this.isFirst=!1,Kg.$("#advertisementContent").addEvent("click",function(){if("fangxing"==e.advertisementType)LogStat({p1:"分享H5页面",p2:"单曲",name:"繁星广告图片点击量",type:1}),LogStat({p1:"分享H5页面",p2:"单曲",name:"正在唱-点击查看",type:1}),setTimeout(function(){location.href=partnerApp.openUrl(e.mUrl+e.roomId)},300);else{var a=phpParam.song_info&&phpParam.song_info.data.songName||"";KtvToolBoxOpenApp.default({type:1,songid:e.ktvSongData.songid},2),KtvToolBoxBi.report({eventname:"航母H5分享页导量唱唱点击",event:"ktv_h5_share_dl_sing_click ",statistics:a+"#"+phpParam.album_audio_id+"#"+e.ktvSongData.songname+"#"+e.ktvSongData.songid})}checkLogCount([30050,{a:28157,b:"点击",ft:"单曲分享H5",r:"分享",mid:KgUser.getKgMid(),userid:phpParam.u,svar1:"fangxing"==e.advertisementType?"直播":"K歌"},null,!1])}),Kg.$("#close_advertisement").addEvent("click",function(){clearTimeout(e.fxTimer),"fangxing"==e.advertisementType?(LogStat({p1:"分享H5页面",p2:"单曲",name:"关闭繁星广告点击量",type:1}),e.$node.hide(),e.show_ktv()):e.$node.hide()}))},show_fangxing:function(e){Kg.$("#advertisement").html("正在唱"),Kg.$("#img_advertisement").attr("src",e),this.advertisementType="fangxing",this.$node.show()},show_ktv:function(){var e=this;if(this.ktvSongData)Kg.$("#advertisement").html("唱这首"),Kg.$("#img_advertisement").attr("src","https://webimg.kgimg.com/37d2b0457f704ab60843548226025139.png"),this.advertisementType="ktv",this.$node.show();else{function a(){KtvToolBoxRequest2.changV3({url:"https://nsongacsing.kugou.com/sing7/accompanywan/json/v3/cors/cdn/optimal_matching_accompany_2_listen_h5.do",data:{mixId:phpParam.album_audio_id,fileName:phpParam.filename||"",hash:phpParam.hash,source:"/播放页/H5播放页"},type:"get"}).then(function(a){if(1==a.status&&a.data&&a.data.songid){var t=phpParam.song_info&&phpParam.song_info.data.songName||"";e.ktvSongData=a.data,e.show_ktv(),KtvToolBoxBi.report({eventname:"航母H5分享页导量唱唱曝光",event:"ktv_h5_share_dl_sing_show ",statistics:t+"#"+phpParam.album_audio_id+"#"+e.ktvSongData.songname+"#"+e.ktvSongData.songid}),checkLogCount([30050,{a:28156,b:"曝光",ft:"单曲分享H5",r:"分享",mid:KgUser.getKgMid(),userid:phpParam.u,svar1:"K歌"},null,!1])}}).catch(function(e){console.warn(e)})}window.KtvToolBoxRequest2?a():Kg.loadScript("https://m3ws.kugou.com/static/js/share/npm/ktv_bi_request_openapp.js",{},a)}},statAdReport:function(e,a){var t={expose:"https://adservice.kugou.com/v3/stat_expose",click:"https://adservice.kugou.com/v3/stat_click"},o=JSON.stringify({userid:KgUser.Cookie.read("KuGoo","KugooID")?KgUser.Cookie.read("KuGoo","KugooID"):"0",vip_type:0,m_type:0,net_type:0,plat:102,isp:7,pos:"mobile_share_h5",metric:e,info:[{on:1,id:a.ad_id||"",ts:Math.floor(+new Date/1e3)}],version:"20000",cors:"true",appid:APPINFO.APP_ID,mid:KgUser.getKgMid()});window.getInterFacePublic({appid:APPINFO.APP_ID},o,{useH5:!0,postType:"urlencoded",callback:function(a){Kg.Ajax({method:"post",url:t[e]+"?"+Util.stringfyQueryString(a),args:o})}})}},pageInit=function(){var e=phpParam.hash||Kg.request.search("hash");phpParam.hash=e;var a=null,t=navigator.userAgent,o=0;if(Kg.UA.isWeibo&&Kg.UA.iphone&&Kg.$("#wrap").css("padding-top","0.6rem"),Kg.UA.iphone?Kg.$("#pop_mask").html('<img src="https://imgessl.kugou.com/h5_pic/20180117200200954200.png" />'):Kg.$("#pop_mask").html('<img src="https://imgessl.kugou.com/h5_pic/20180117200200574163.png" />'),Kg.$("#pop_mask").addEvent("click",function(){var e=Kg.$(this);setTimeout(function(){e.hide()},100)}),Kg.$(".btn_down_weixin").addEvent("click",function(){var e=this,a=appURL||Kg.$(e).attr("_href");Kg.$(e).attr("logid");LogStat({p1:"分享H5页面",p2:"单曲",name:"没版权歌曲-下载客户端点击量",type:2}),LogStat({p1:"分享H5页面",p2:"单曲",name:"没版权歌曲-"+_chl+"-下载客户端点击量",type:2}),setTimeout(function(){location.href=partnerApp.openUrl(a)},300)}),Kg.$("#popK").addEvent("click",function(){Kg.$("#pop_down").hide()}),Kg.$("#mod_lrc").addEvent("click",function(){LogStat({p1:"分享H5页面",p2:"单曲",name:"歌词点击量",type:1})}),Kg.$("#singer_cover_bg").addEvent("click",function(){LogStat({p1:"分享H5页面",p2:"单曲",name:"歌曲图片点击量",type:1})}),Kg.$("#vip-dialog").addEvent("touchmove",function(e){return e.preventDefault(),!1}),Kg.$(".vip-dialog .vip-dialog-close,.vip-dialog .mask").addEvent("click",function(){Kg.$(".vip-dialog").hide()}),Kg.$("#vip-dialog-open-vip").addEvent("click",function(){checkLogCount([30050,{a:27249,b:"点击",ft:"单曲分享H5-试听弹窗",r:"单曲分享H5",mid:KgUser.getKgMid(),userid:phpParam.u||"",uuid:KgUser.getDfid(APPINFO.APP_ID),lst:+new Date},null,!1]),setTimeout(function(){userInfo.isLogin?location.href="http://m.kugou.com/vip/v3/vip.html?source_id=207401&url="+encodeURIComponent(location.href.split("#")[0]):location.href="http://m.kugou.com/loginReg.php?act=login&appid="+APPINFO.APP_ID+"&url="+encodeURIComponent(location.href.split("#")[0])},50)}),Kg.$("#toVip").addEvent("click",function(){location.href="http://m.kugou.com/vip/v3/vip.html?source_id=207402&url="+encodeURIComponent(location.href.split("#")[0]),Kg.$("#code-dialog").hide()}),Kg.$("#code-dialog-close").addEvent("click",function(){Kg.$("#code-dialog").hide()}),Kg.$(".btn_down").addEvent("click",function(){clearTimeout(a);var e=this,i=(Kg.$(e).attr("logid"),"kugou://start.weixin"),n="kugouurl://start.weixin",r=appURL||Kg.$(e).attr("_href"),s="";if(LogStat({p1:"分享H5页面",p2:"单曲",name:"没版权歌曲-下载客户端点击量",type:2}),"微信"!=_chl&&"微信朋友圈"!=_chl||LogStat({p1:"分享H5页面",p2:"单曲",name:"微信外部-点击下载",type:2}),LogStat({p1:"分享H5页面",p2:"单曲",name:"没版权歌曲-"+_chl+"-下载客户端点击量",type:2}),t.match(/iPhone|iPod/)?s=n:t.match(/Android/)?s=i:t.match(/iPad/)&&(s=n),Kg.UA.isWeibo||Kg.UA.isMobileQQ||Kg.UA.isQzone&&Kg.UA.android?r=appURL||r:Kg.UA.isWeiXin?r=appURL||r:Kg.UA.isMQQBrowser&&Kg.UA.android&&(r=appURL||"http://a.app.qq.com/o/simple.jsp?pkgname=com.kugou.android"),1==o)location=s;else if(2==o)r&&(location.href=r);else if(t.match(/Android/)){var d=document.createElement("iframe");d.style.width="1px",d.style.height="1px",d.style.display="none";(new Date).valueOf();d.src=s,document.body.appendChild(d),a=setTimeout(function(){document.webkitHidden||(window.location.href=r)},2e3)}else if(t.match(/iPhone|iPad|iPod/)){(new Date).valueOf();window.location.href=s,a=setTimeout(function(){document.webkitHidden||(window.location.href=r)},2e3)}}),e){var i=[{hash:e}];myplayer.addSongsAndPlay({songs:i})}},isappinstalled=phpParam.isappinstalled||Kg.request.search("isappinstalled");pageInit(),checkLogCount([logCount.BIbusiness,{b:"主页曝光",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar1:phpParam.from||window.searchSource,user_id:phpParam.u,ivar3:phpParam.p_speed||"",svar2:phpParam.chl2||""},null,!1]);var privilegeSvar3="0";if(phpParam.song_info&&phpParam.song_info.data&&phpParam.song_info.data.stype){var songData=phpParam.song_info.data,obj={ctype:songData.ctype||"",stype:songData.stype||"",privilege:null!=songData.privilege?songData.privilege:"",cpy_attr0:songData.trans_param?songData.trans_param.cpy_attr0:"",audition_status:songData.audition_status};privilegeSvar3=Util.stringfyQueryString(obj)}checkLogCount([30050,{a:24266,b:"曝光",ft:"单曲分享H5页面曝光",r:"单曲分享H5",hash:phpParam.hash,mid:KgUser.getKgMid(),userid:phpParam.u,uuid:KgUser.getDfid(APPINFO.APP_ID),lst:+new Date,svar1:"comment"==Util.getQueryString("from")?0:"",svar3:privilegeSvar3},null,!1]);var hreffromVal=Util.getQueryString("hreffrom"),source=getSource(),sourceMap={baidusousuo:{ios:"https://apps.apple.com/app/apple-store/id472208016?pt=624347&ct=seogbdgqy&mt=8",android:"https://downmobile.kugou.com/promote/package/download/channel=113&s=1"},baidulunbo:{ios:"https://apps.apple.com/app/apple-store/id472208016?pt=624347&ct=bdhzgqy&mt=8",android:null},toutiao:{ios:"https://apps.apple.com/app/apple-store/id472208016?pt=624347&ct=seottgqy&mt=8",android:"https://downmobile.kugou.com/promote/package/download/channel=116&s=1"},tthezuo:{ios:"https://apps.apple.com/app/apple-store/id472208016?pt=624347&ct=tthzgqy&mt=8",android:"https://downmobile.kugou.com/promote/package/download/channel=116&s=1"}};(source||hreffromVal)&&checkLogCount([30050,{a:24585,b:"曝光",ft:"主页面",r:"歌手H5页面",mid:KgUser.getKgMid(),userid:userInfo.uid||"",hreffrom:source||hreffromVal||"",svar1:phpParam.song_info&&phpParam.song_info.data&&phpParam.song_info.data.singerId||"",svar2:"播放页",svar3:phpParam.hash||""},null,!1]);var relationShip={dataList:!1,isSet:!0,type:!1,upload:function(){var e=this,a="",t=e.dataList.list.length>5?5:e.dataList.list.length;if(t>0){for(var o=0;o<t;o++)a+=e.dataList.list[o].u+","+e.dataList.list[o].h1+";";checkLogCount([logCount.BIbusiness,{b:"好友关系链",share_chl:_chl,share_type:"单曲",hash:phpParam.hash,ivar1:phpParam.from||window.searchSource,user_id:phpParam.u,svar1:userInfo.uid,svar2:a,ivar3:phpParam.p_speed||""},function(){relationShip.callback()},!1])}},callback:function(){var e=this;e.type?(e.dataList.list.length>5?e.dataList.list.splice(0,5):e.dataList.list=[],e.type=!1,cookie.setCookie("uidData",JSON.stringify(e.dataList),new Date((new Date).getTime()+31536e6)),e.dataList.list.length>0&&e.upload()):e.type=!0},init:function(){var e=this;if(e.dataList=decodeURIComponent(cookie.getCookie("uidData"))||!1,e.dataList&&"null"!=e.dataList?e.dataList=JSON.parse(e.dataList):e.dataList={list:[]},phpParam.u){for(var a=0;a<e.dataList.list.length;a++)if(phpParam.u==e.dataList.list[a].u){e.isSet=!1,e.dataList.list.splice(a,1),e.dataList.list.splice(0,0,{u:phpParam.u,h1:phpParam.h1});break}}else if(phpParam.h1)for(a=0;a<e.dataList.list.length;a++)if(phpParam.h1==e.dataList.list[a].h1){e.isSet=!1,e.dataList.list.splice(a,1),e.dataList.list.splice(0,0,{u:"",h1:phpParam.h1});break}e.isSet&&(e.dataList.list.splice(0,0,{u:phpParam.u||"",h1:phpParam.h1}),e.dataList.list.length>50&&e.dataList.list.splice(50,1)),cookie.setCookie("uidData",JSON.stringify(e.dataList),new Date((new Date).getTime()+31536e6)),userInfo.isLogin&&e.upload()}};relationShip.init();var partnerApp={app_id:-1,openUrl:function(e){return 2==partnerApp.app_id&&Kg.UA.isWeiXin&&Kg.UA.android&&e.indexOf("a.app.qq.com")>-1?"http://downmobile.kugou.com/promote/package/download/channel=836":e},request:function(){var e=navigator.userAgent.toLocaleLowerCase();if(Kg.UA.isWeiXin&&Kg.UA.android&&(null!=e.match(/tencenttraveler/)||null!=e.match(/qqbrowse/))&&(Math.random()>.5?partnerApp.app_id=1:partnerApp.app_id=2,console.log("partnerApp.app_id",partnerApp.app_id)),Kg.UA.isWeiXin&&Kg.UA.android){var a=null!=e.match(/tencenttraveler/)||null!=e.match(/qqbrowse/);console.log("isX5",a),checkLogCount([30050,{a:21749,b:"统计",ft:"是否X5内核",r:"单曲分享H5页面",mid:KgUser.getKgMid(),userid:phpParam.u,svar1:a?"X5内核":"非X5内核"},null,!1])}}},apiQuest={similar_recommend:function(e){var a=+new Date,t={hash:phpParam.hash,filename:phpParam.filename,userid:0,long:1,appid:APPINFO.APP_ID,clientver:APPINFO.CLIENT_VER,clienttime:a,mid:KgUser.getKgMid(),key:hex_md5(APPINFO.APP_ID+APPINFO.APP_KEY+APPINFO.CLIENT_VER+a),split:1,split_page_index:1,split_page_size:3};kgRequest.gateWay(["http://musiclib.service.kugou.com","http://musiclib.service.kugou.com"],"/v1/song_recommend",t,{type:"POST",callback:function(a){var t="";try{t=a.data.data.list}catch(e){}e&&e(t)}})},getAudioGroupList:function(e){var a=+new Date,t={audio_group_id:phpParam.song_info&&phpParam.song_info.data&&phpParam.song_info.data.audio_group_id,page:1,pagesize:6,appid:APPINFO.APP_ID,clientver:APPINFO.CLIENT_VER,clienttime:a,mid:"no_bug",key:"-"};kgRequest.gateWay(["http://kmr.service.kugou.com","http://kmr.service.kugou.com"],"/container/v3/collection_audio",t,{type:"POST",callback:function(a){var t="";try{t=a.data.data[0].data}catch(e){}e&&e(t)}})},getSongVideo:function(e){var a=+new Date,t=t||{},o={appid:APPINFO.APP_ID,clientver:APPINFO.CLIENT_VER,clienttime:a,mid:KgUser.getKgMid(),dfid:KgUser.getDfid(APPINFO.APP_ID)},i={appid:APPINFO.APP_ID,clientver:APPINFO.CLIENT_VER,clienttime:a,userid:t.uid||0,token:t.clienttoken||"",mid:KgUser.getKgMid(),key:APPINFO.APP_KEY,data:[{album_audio_id:phpParam.album_audio_id,audio_id:phpParam.audio_id,hash:phpParam.hash}]};window.getInterFacePublic(o,i,{useH5:!1,postType:"urlencoded",callback:function(a){var t=Util.stringfyQueryString(a);kgRequest.gateWay(["http://kmr.service.kugou.com","http://kmr.service.kugou.com"],"/v2/video/audio?"+t,i,{type:"POST",callback:function(a){var t="";try{t=a.data.data[0].videos[0]}catch(e){}e&&e(t)}})}})},getAuthorV2:function(e,a){window.getInterFacePublic({appid:APPINFO.APP_ID,singer_ids:e.join(",")},"",{useH5:!1,postType:"urlencoded",callback:function(e){var t=Util.stringfyQueryString(e);Kg.Ajax({docType:"json",method:"post",url:"https://m3ws.kugou.com/api/v1/singer/minfov2?"+t,callback:function(e){var t="";try{t=e.data&&e.data.list}catch(e){}a&&a(t)}})}})}},otherMode={clickReportBI:function(e,a){checkLogCount([30050,{a:22401,b:"点击",ft:e,r:"单曲分享H5页面",mid:KgUser.getKgMid(),userid:phpParam.u,svar1:a,svar2:_chl,svar4:phpParam.hash,svar5:phpParam.from||window.searchSource||Util.getQueryString("from")},null,!1])},init:function(){this.setTag(),this.setSimilarSong(),comment.loadComment(),this.initScroll()},secondInit:function(){this.setAudioGroupList(),this.setRecommendVideo(),this.setCurAuthorMsg()},modeIdArr:[{id:"mod_similar"},{id:"comment_scroll"},{id:"similar_song_list"},{id:"mod_singer"},{id:"mod_video"}],updateModeOffsetTop:function(){try{for(var e=[],a=0;a<this.modeIdArr.length;a++)document.querySelector("#"+this.modeIdArr[a].id)&&e.push(document.querySelector("#"+this.modeIdArr[a].id).offsetTop||0);var t=[],o=[];e.forEach((e,a)=>{0!=e&&(o.push(e),t.push(this.modeIdArr[a]))}),this.modeIdArr=t;for(var i=0;i<o.length;i++){var n=0==i?0:o[i],r=o[i+1]||1e5;this.modeIdArr[i].value=[n,r]}}catch(e){}},initScroll:function(){Kg.$(document).addEvent("scroll",function(e){if(window.lockTagCheckScroll)console.log("lockTagCheckScroll锁住");else{var a=document.querySelector(".othermodWrap"),t=a&&a.offsetTop,o=document.querySelector("#mod_user")&&document.querySelector("#mod_user").offsetHeight||0,i=document.querySelector(".modeTagWrap")&&document.querySelector(".modeTagWrap").offsetHeight||0;window.scrollY>t-o?(Kg.$(".othermodWrap").removeClass("fixedTag").addClass("fixedTag"),Kg.$("#mod_user_area").removeClass("fixedTagStatus").addClass("fixedTagStatus"),Kg.$(".modeTagWrap").css("top",o?"1.1rem":0)):(Kg.$(".othermodWrap").removeClass("fixedTag"),Kg.$("#mod_user_area").removeClass("fixedTagStatus"));var n=window.scrollY+o+i;otherMode.modeIdArr.forEach(e=>{var a=document.querySelector("#"+e.id+"_tag");e.value&&e.value[1]&&n>e.value[0]&&n<e.value[1]&&a?a.className="active":a&&(a.className="")})}})},setTag:function(){Kg.$(".othermodWrap").prepend('<div class="modeTagWrap"><div class="modeTagContent"><span class="active" id="mod_similar_tag">歌曲</span><span id="comment_scroll_tag">评论</span><span id="similar_song_list_tag">歌单</span><span id="mod_singer_tag">歌手</span><span id="mod_video_tag">视频</span></div></div>'),Kg.$(".modeTagWrap span").addEvent("click",function(e){var a=Kg.$(e.target).attr("id"),t=Kg.$(e.target).html();Kg.$(".modeTagWrap span").removeClass("active"),document.querySelector("#"+a)&&(document.querySelector("#"+a).className="active"),a&&(a=a.replace("_tag",""));var o=document.querySelector("#"+a);if(o){var i=document.querySelector("#mod_user")&&document.querySelector("#mod_user").offsetHeight||0,n=document.querySelector(".modeTagWrap")&&document.querySelector(".modeTagWrap").offsetHeight||0;o&&(window.lockTagCheckScroll=!0,Kg.$(".othermodWrap").removeClass("fixedTag").addClass("fixedTag"),Kg.$("#mod_user_area").removeClass("fixedTagStatus").addClass("fixedTagStatus"),Kg.$(".modeTagWrap").css("top",i?"1.1rem":0),window.scrollTo(0,document.querySelector("#"+a).offsetTop-i-n),setTimeout(function(){window.lockTagCheckScroll=!1},200),t&&["歌曲","评论","歌单","歌手","视频"].indexOf(t)>-1&&checkLogCount([30050,{a:28158,b:"点击",ft:"单曲分享H5",r:"分享",mid:KgUser.getKgMid(),userid:phpParam.u,svar1:t},null,!1]))}})},setFootbtn:function(e){e?Kg.$(".mod_content").append('<div id="openAppBtn" class="openAppBtn fixed">打开酷狗收听更多精彩</div>'):Kg.$(".othermodWrap").append('<div id="openAppBtn" class="openAppBtn">打开酷狗收听更多精彩</div>'),Kg.$("#openAppBtn").addEvent("click",function(){downloadModule.startForAppPlay(5,"openAppBtn"),otherMode.clickReportBI("拉起播放页","底部打开酷狗APP")}),Kg.UA.isWeibo&&setTimeout(function(){document.querySelector("#openAppBtn").click()},100)},setRecommendVideo:function(){3!=phpParam._songStatus?apiQuest.getSongVideo(function(e){if(e){Kg.$("#mod_video_tag").show();var a=e.hdpic||e.thumb;a=a.replace("{size}",150),a=replaceHttpsImg(a||"https://m3ws.kugou.com/static/images/single2020/video_default.png"),Kg.$(".mod_video").append('<div class="videoItem"><div class="video_bg"></div><div class="leftItem"><p class="first nowrap1"></p><p class="sec nowrap1"></p></div></div>'),Kg.$(".mod_video .videoItem .video_bg").css("background-image","url("+a+")"),Kg.$(".mod_video .videoItem .first").html(e.video_name),Kg.$(".mod_video .videoItem .sec").html(e.author_name),Kg.$(".videoItem").addEvent("click",function(){var a={cmd:308,jsonStr:{filename:e.video_name,singername:e.author_name,hash:e.mkv_sd_hash||e.qhd_hash||e.sd_hash||e.ld_hash,imgurl:e.cover||e.thumb||e.hdpic,btnh5:13,cyt2:"video",userid:phpParam.u,chl:phpParam.chl,chl2:phpParam.chl2||"",secondShareChl:secondShareChl},type:"some",action:null};downloadModule.openKg(a),otherMode.clickReportBI("视频","点击相关视频")})}else Kg.$("#mod_video").hide();otherMode.updateModeOffsetTop()}):otherMode.updateModeOffsetTop()},setCurAuthorMsg:function(){if(phpParam.song_info&&phpParam.song_info.data&&phpParam.song_info.data.authors&&phpParam.song_info.data.authors.length){for(var e=phpParam.song_info.data.authors,a=[],t=e.length&&e.length>3,o=0;o<e.length&&o<3;o++)a.push(e[o].author_id);apiQuest.getAuthorV2(a,function(a){if(Kg.$("#mod_singer").show(),Kg.$("#mod_singer_tag").show(),a&&a.length>0){for(var o='<h2 class="com_title">歌手</h2><div class="singerListItemWrap">',i=0;i<a.length;i++){var n=a[i];e[i].fans=n.fans||0,e[i].is_resident_singer=n.is_resident_singer,e[i].status=n.status,e[i].avatar=e[i].avatar?replaceHttpsImg(e[i].avatar.replace("{size}",200)):"https://m3ws.kugou.com/static/images/single2020/singer_default.png";var r=e[i].fans;r>=1e4&&(r=(r/1e4).toFixed(1)+"万",r=r.replace(".0","")),e[i].fans_str=r+"粉丝",o+='<div class="singerListItem" index="'+i+'"><div class="singer_bg singer_default_bg" style="background-image: url('+e[i].avatar+')"></div><div class="leftItem"><p class="first nowrap1"><span class="nowrap1">'+e[i].author_name+'</span><i style="display:'+(e[i].is_resident_singer?"inline-block":"none")+'"></i></p><p class="sec nowrap1"><i class="fans">'+e[i].fans_str+'</i></p></div><span class="attention">关注</span></div>'}o+="</div>",t&&(o+='<div id="singer_more" class="singer_more" style="display: block;">查看全部歌手</div>'),Kg.$("#mod_singer").html(o),Kg.$(".mod_singer .singerListItem").addEvent("click",function(){var a=Kg.$(this).attr("index"),t={cmd:305,jsonStr:{singerid:e[a].author_id,singerName:e[a].author_name,btnh5:12,cty2:"singer",userid:phpParam.u,chl:phpParam.chl,chl2:phpParam.chl2||"",secondShareChl:secondShareChl},type:"some"};downloadModule.openKg(t),otherMode.clickReportBI("歌手","点击相关歌手")}),t&&Kg.$(".mod_singer .singer_more").addEvent("click",function(){downloadModule.startForAppPlay(12,"singer_more"),otherMode.clickReportBI("歌手","点击查看全部歌手")})}else Kg.$("#mod_singer").hide();otherMode.updateModeOffsetTop()})}else Kg.$("#mod_singer").hide(),otherMode.updateModeOffsetTop()},setAudioGroupList:function(){apiQuest.getAudioGroupList(function(e){if(e&&e.length){Kg.$("#similar_song_list_tag").show();for(var a="",t=0;t<e.length;t++){var o=e[t],i=o.cover||"https://m3ws.kugou.com/static/images/single2020/song_list_default.png";a+='<div class="song_list_item" index="'+t+'"><div class="song_list_item_bg song_list_default"  style="background-image:url('+replaceHttpsImg(i)+')"></div><p class="nowrap2">'+o.collection_name+"</p></div>"}Kg.$(".song_list_wrap").html(a),Kg.$(".song_list_wrap .song_list_item").addEvent("click",function(){var a=Kg.$(this).attr("index"),t=e[a],o={cmd:302,jsonStr:{userID:t.user_id,listID:t.collection_id,listName:t.collection_name,ctype:1,isplay:2,specialID:t.collection_id,share_subtype:0,btnh5:11,cyt2:"song_list",userid:phpParam.u,chl:phpParam.chl,chl2:phpParam.chl2||"",secondShareChl:secondShareChl},type:9,action:0};downloadModule.openKg(o),otherMode.clickReportBI("歌单","点击歌单")})}else Kg.$(".similar_song_list").hide(0);otherMode.updateModeOffsetTop()})},setSimilarSong:function(){apiQuest.similar_recommend(function(e){if(Kg.$("#similar_loading").hide(),e){Kg.$("#mod_similar_tag").show();for(var a="",t=0;t<e.length;t++){var o=e[t],i=o.filename.split(/ - /),n=o.sizable_cover.replace(/{size}/,"120")||"https://m3ws.kugou.com/static/images/single2020/song_list_default.png";a+='<li class="song_list_item" index="'+t+'"><div class="itemLeft"><div class="song_list_bg song_list_default" style="background-image:url('+replaceHttpsImg(n)+')"></div><div class="leftText"><p class="nowrap1"> '+(i[1]?i[1]:"")+'</p><span class="nowrap1">'+(i[0]?i[0]:"")+'<span></div></div><span class="playIcon"></span></li>'}Kg.$("#mod_similar ul").html(a),Kg.$("#mod_similar .song_list_item").addEvent("click",function(){var a=Kg.$(this).attr("index"),t=e[a];try{var o={cmd:212,jsonStr:{hash:t.hash,filename:unescape(t.filename),bitrate:t.bitrate||0,duration:t.time_length||0,extname:t.extname||0,privilege:t.privilege||"","320privilege":"",sqprivilege:"",album_audio_id:t.mixsongid||"",trans_param:t.trans_param||"",needfav:!1,btnh5:5,cyt2:"similar_song",userid:phpParam.u,chl:phpParam.chl,chl2:phpParam.chl2||"",secondShareChl:secondShareChl},type:1,action:1};downloadModule.openKg(o,""),otherMode.clickReportBI("相似歌曲","点击相似歌曲")}catch(e){console.log(e)}})}else Kg.$("#mod_similar").hide(),Kg.$("#comment_scroll_tag").addClass("active");otherMode.updateModeOffsetTop()})}};document.addEventListener("visibilitychange",function(){var e=document.hidden;e&&(window.isHiddenTime=+new Date)});