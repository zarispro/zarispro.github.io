!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).kgRequest=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function r(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?n(Object(o),!0).forEach((function(n){t(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var o={request:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.type||"GET";if("GET"==(a=a.toUpperCase())){var c="";Object.keys(n).forEach((function(e){c+=e+"="+n[e]+"&"})),""!==c&&(c=c.substr(0,c.lastIndexOf("&")),t=t+"?"+c)}var i=function(c){var i;i=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject;var u="";if("POST"==a)if("urlencoded"==r.postType){for(var l in n)u+=l+"="+n[l]+"&";u=u.substr(0,u.length-1)}else if("formdata"==r.postType){var s=new FormData;for(var l in n)s.append(l,n[l]);u=s}else u=JSON.stringify(n);if(i.open(a,t,!0),r.headers)for(var l in r.headers)i.setRequestHeader(l,r.headers[l]);"POST"==a?i.send(u):i.send(null),i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){var t=i.response;if("object"!==e(t))try{t=JSON.parse(t)}catch(e){}c({data:t,header:o.getHeader(i)})}else c(null)}};if(!r.callback)return new Promise((function(e,t){i((function(t){e(t)}))}));i(r.callback)},requestByRetry:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!a.headers&&(a.headers=[]);var c={headers:r({},a.headers,{},a.headers["x-router"]?{"x-router":a.headers["x-router-backup"]||a.headers["x-router"]}:{})};if(!a.callback)return new Promise((function(i,u){o.request(e[0]+t,n,a).then((function(u){!u&&e[1]?o.request(e[1]+t,n,r({},a,{},c)).then((function(e){i(e)})):i(u)}))}));o.request(e[0]+t,n,r({},a,{callback:function(i){!i&&e[1]?o.request(e[1]+t,n,r({},a,{},c,{callback:function(e){a.callback(e)}})):a.callback(i)}}))},gateWay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c={headers:r({"Content-type":"application/json","x-router":(e=e.map((function(e){return e.replace(/https:\/\/|http:\/\//gi,"")})))[0]},e[1]?{"x-router-backup":e[1]}:"")};if(!a.callback)return new Promise((function(e,i){o.requestByRetry(["https://gateway.kugou.com","https://gatewayretry.kugou.com"],t,n,r({},a||{},{},c)).then((function(t){e(t)}))}));o.requestByRetry(["https://gateway.kugou.com","https://gatewayretry.kugou.com"],t,n,r({},a||{},{},c,{callback:function(e){a.callback(e)}}))},getHeader:function(e){for(var t=e.getAllResponseHeaders().split(/\r\n/),n={},r=0;r<t.length;r++)if(t[r]){var o=t[r].split(":");n[o[0]]=o[1].replace(/^\s+/,"")}return n},loadJSONP:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=a.jsonp||"callback",i=a.jsonpCallback||"jsonp_"+Math.random().toString().substr(2,9);if(n&&"object"!==e(n))n+="&".concat(c,"=").concat(i);else{var u={};u[c]=i,n=r({},n,{},u)}var l=function(e){window[i]=function(t){window[i]=null,e(t)},o.loadScript(t,n)};if(!a.callback)return new Promise((function(e,t){l((function(t){e(t)}))}));l(a.callback)},loadScript:function(t,n,r){var o=n||"";if(n&&"object"===e(n)){var a="";for(var c in n)a+=c+"="+n[c]+"&";o=a.substr(0,a.length-1)}o=o.trim();var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(r&&r(),i.onreadystatechange=i=r=null)}:i.onload=function(){r&&r(),i.onload=i=r=null},i.src=t+(o?"?"+o:""),document.getElementsByTagName("head")[0].appendChild(i)}};return{request:o.request,requestByRetry:o.requestByRetry,gateWay:o.gateWay,loadJSONP:o.loadJSONP,loadScript:o.loadScript}}));
//# sourceMappingURL=kgRequest.min.js.map
