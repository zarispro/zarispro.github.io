!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self,e.share=t())}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e){var t=e,n="kz8F9YI0f7EMXyITzpgGFa3aT0wmwYR9Host2yFlPrUKE+DFY9jJDvXdVsQDOLa1YTOY7wnPTEN0PKyiWJsNDuM5ujSh5zvJvALS7sC3t/9mkHJinBN5yc9/pN0s2DyB2qz4W9rL5BUmfTqjcMb4jDbK+TJUZE/fEI9nKMILhs0=";if(o.isFanxing){t&&t.sign&&(n=t.sign);var i={};i.cmd=t.cmd,i.sign=n,i.jsonStr=t.jsonStr,t.callbackName&&(i.callback=t.callbackName);var a=JSON.stringify(i);o.iphone?location.href="fanxing2://"+(t.isBanner?"fx.activity":"send.message")+"/?"+a:window.external&&window.external.callFanxing&&window.external.callFanxing(a)}}function n(e){var t="cb"+(new Date).getTime();window[t]=function(t){"string"==typeof t?e.success(JSON.parse(t)):e.success(t)};var n=document.createElement("script");n.src=e.url+"&callback="+t;for(var i in e.data)n.src+="&"+i+"="+e.data[i];document.getElementsByTagName("body")[0].appendChild(n)}var i=navigator.userAgent.toLowerCase(),o={Ie:!!document.all,Ie6:!!document.all&&!window.XMLHttpRequest,Ie7:!!document.all&&/msie 7.0/gi.test(window.navigator.appVersion),Ie8:!!document.all&&/msie 8.0/gi.test(window.navigator.appVersion),FF:/firefox/gi.test(window.navigator.userAgent),Opera:/opera/gi.test(window.navigator.userAgent),Chrom:/Chrom/gi.test(window.navigator.userAgent),Maxthon:/Maxthon/gi.test(window.navigator.userAgent),android:/android|Adr/gi.test(i),iphone:/iPhone|iPod|iPad/gi.test(i),isWeiXin:i.indexOf("micromessenger")>-1,isMobileQQ:i.indexOf("sq")>-1&&i.indexOf("yyb_d")>-1||i.indexOf("iphone os")>-1&&i.indexOf("qq/")>-1,isQzone:i.indexOf("qzone")>-1,isWeibo:i.indexOf("weibo")>-1,isMQQBrowser:i.indexOf("mqqbrowser")>-1,isFanxing:/fanxing2/.test(i)};window.getBase64=function(e,t){var n=new Image;n.setAttribute("crossOrigin","anonymous"),n.src=e,n.onload=function(){var e=document.createElement("canvas");e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(n,0,0,e.width,e.height);var i=e.toDataURL();t&&t(i)}};var a=function(t,n){if("object"==e(t)&&"object"==e(n))for(var i in n)t[i]=n[i];if("function"==typeof t){if("object"==e(n))for(var i in n)t.prototype[i]=n[i];"function"==typeof n&&(t.prototype=n.prototype)}return t},r={ver:"2.2",debug:0,isAndroid:"undefined"!=typeof external&&void 0!==external.superCall,isIOS:!!navigator.userAgent.match(/KGBrowser/gi),chkAndroidApp:function(){try{if(external.superCall(122))return!0}catch(e){return!1}},cbNum:0,formatURL:{browser:"",url:""},formatSong:{filename:"",filesize:"",hash:"",bitrate:"",extname:"",duration:"",mvhash:"",m4afilesize:"","320hash":"","320filesize":"",sqhash:"",sqfilesize:0,feetype:0,isfirst:0},formatMV:{filename:"",singername:"",hash:"",imgurl:""},formatShare:{shareName:"",topicName:"",hash:"",listID:"",type:"",suid:"",slid:"",imgUrl:"",filename:"",duration:"",shareData:{linkUrl:"",picUrl:"",content:"",title:""}},_extend:function(e,t){if(t)for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);return t},str2Json:function(e){var t={};if("[object String]"===Object.prototype.toString.call(e))try{t=JSON.parse(e)}catch(e){t={}}return t},json2Str:function(e){var t="";if("string"!=typeof e)try{t=JSON.stringify(e)}catch(e){t=""}return t},loadUrl:function(e){var t;(t=document.createElement("iframe")).setAttribute("src",e),t.setAttribute("style","display:none;"),t.setAttribute("height","0px"),t.setAttribute("width","0px"),t.setAttribute("frameborder","0"),document.body.appendChild(t),t.parentNode.removeChild(t),t=null},callCmd:function(e){var t,n=this,i="",o=document;if(o.getElementById("mod_debugwin_set")&&(o.getElementById("mod_debugwin_set").innerHTML=JSON.stringify(e).replace(/\\/g,"")),n.debug>0)switch(n.debug){case 1:window.console&&console.log(e);break;case 2:alert(JSON.stringify(e).replace(/\\/g,""))}if(n.chkAndroidApp())try{t=e.jsonStr?external.superCall(e.cmd,e.jsonStr):external.superCall(e.cmd),e.callback&&""!==e.callback&&(t=n.str2Json(t),e.callback(t))}catch(e){}else if(n.isIOS){if(e.callback){var a="kgmobilecall"+ ++n.cbNum+Math.random().toString().substr(2,9);window[a]=function(t){void 0!==t&&e.callback&&("[object String]"===Object.prototype.toString.call(t)?e.callback(n.str2Json(t)):e.callback(t))},i=e.jsonStr?'kugouurl://start.music/?{"cmd":'+e.cmd+', "jsonStr":'+e.jsonStr+', "callback":"'+a+'"}':'kugouurl://start.music/?{"cmd":'+e.cmd+', "callback":"'+a+'"}'}else i=e.jsonStr?'kugouurl://start.music/?{"cmd":'+e.cmd+', "jsonStr":'+e.jsonStr+"}":'kugouurl://start.music/?{"cmd":'+e.cmd+"}";n.loadUrl(i)}else e.callback&&e.callback({status:0,error:"不在客户端内"})},getVersion:function(e){this.callCmd({cmd:122,callback:e})},share:function(e,t,n,i){var a=this,r={},s=function(){var t={title:encodeURIComponent(e.shareData.title)||"",url:e.shareData.linkUrl||"",content:encodeURIComponent(e.shareData.content)||"",imgSrc:encodeURI(e.shareData.picUrl)||"",swf:"",appkey:"340086183",ralateUid:""},n="",i="";n="http://service.t.sina.com.cn/share/share.php",i=["url="+t.url,"appkey="+t.appkey,"title="+t.content,"pic="+t.imgSrc,"ralateUid="+t.ralateUid].join("&"),location.href=n+"?"+i};e&&(r=a._extend(a.formatShare,e),e=r),a.isIOS?t?a.callCmd({cmd:115,jsonStr:a.json2Str(e),callback:t}):a.callCmd({cmd:115,jsonStr:a.json2Str(e)}):a.chkAndroidApp()?a.getVersion(function(t){t&&e&&3==e.type&&"android"==t.platform&&Number(t.version)<6340?s():a.callCmd({cmd:115,jsonStr:a.json2Str(e)})}):o.isWeiXin||o.isMobileQQ?n?n():s():i?i():s()},multiShare:function(e,t){var n=this,i="";i=n.json2Str(e),t?n.callCmd({cmd:294,jsonStr:i,callback:t}):n.callCmd({cmd:294,jsonStr:i})},isInClient:function(){var e=this;return!(!e.isAndroid&&!e.isKugouAndroid)||!!e.isIOS&&e.isIOS},shareMiniProgram:function(e){var t=this,n="";n=t.json2Str(e),t.callCmd({cmd:269,jsonStr:n})}};!function(){function e(e,t){var n=document,i=n.head||n.getElementsByTagName("head")[0]||n.documentElement,o=n.createElement("script");o.onload=t,o.onerror=function(){},o.async=!0,o.src=e[0],i.appendChild(o)}function t(e){function t(){try{e.callback?window.mqq.ui.setOnShareHandler(function(t){3==t&&(e.swapTitle||e.WXconfig&&e.WXconfig.swapTitleInWX)?n.title=e.summary:n.title=e.title,n.share_type=t,n.back=!0,window.mqq.ui.shareMessage(n,function(t){0===t.retCode&&e.callback&&e.callback.call(this,t)})}):window.mqq.data.setShareInfo(n)}catch(e){}}var n={title:e.title,desc:e.summary,share_url:e.url,image_url:e.pic};window.mqq?t():o([a],function(){t()})}function n(e){function t(){if(QZAppExternal&&QZAppExternal.setShare){for(var t=[],n=[],i=[],o=[],a=0;a<5;a++)t.push(e.pic),o.push(e.url),4===a&&(e.swapTitle||e.WXconfig&&e.WXconfig.swapTitleInWX)?(n.push(e.summary),i.push(e.title)):(n.push(e.title),i.push(e.summary));QZAppExternal.setShare(function(e){},{type:"share",image:t,title:n,summary:i,shareURL:o})}}window.QZAppExternal?t():o([r],function(){t()})}function i(e){var i=navigator.userAgent,o=(i.match(/MicroMessenger\/([\d\.]+)/),i.match(/QQ\/([\d\.]+)/)),a=-1!==i.indexOf("Qzone/");o&&t(e),a&&n(e)}var o,a="//open.mobile.qq.com/sdk/qqapi.js?_bid=152",r="//qzonestyle.gtimg.cn/qzone/phone/m/v4/widget/mobile/jsbridge.js?_bid=339";o=e,window.setShareInfo=i}();var s=function(){function e(e,t){window.kgWxEnvir.init(t,e)}function t(e){window.kgWxEnvir.share(e)}function i(){if(/MicroMessenger/i.test(navigator.userAgent)){var e,t=decodeURIComponent(window.location.search);if(""==t&&window.location.hash&&-1!=window.location.hash.indexOf("?")&&(t="?"+decodeURIComponent(window.location.hash).split("?")[1]),-1!=t.indexOf("openid")&&-1!=t.indexOf("unionid")){var n={openid:"",unionid:"",nickname:"",sex:"",city:"",province:"",country:"",headimgurl:""};t=t.substr(1).split("&");for(var i=0;i<t.length;i++)-1!=(e=t[i]).indexOf("openid")&&(e=e.substring(e.indexOf("openid"))),(e=e.split("=")).length>1&&void 0!=n[e[0]]&&(n[e[0]]=e[1]);return n}return void(window.location.href=function(){var e=window.location.href;return"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx412c15698d95020e&redirect_uri="+encodeURIComponent("https://mwechats.kugou.com/service/user/getInfo?redirect_uri="+encodeURIComponent(e))+"&response_type=code&scope=snsapi_userinfo&state=1&connect_redirect=1#wechat_redirect"}())}return null}function o(){var e=["m3ws.kugou.com","ep.kugou.com","activity.kugou.com","h5.kugou.com","m.kugou.com"],t=["m3ws.kugou.com","mtpls.kugou.com","h5.kugou.com","m.kugou.com"],n=window.location.host;-1!=e.join(",").indexOf(n)?this.useNewShare=!1:-1!=t.join(",").indexOf(n)?this.useNewShare=!0:this.useNewShare=!1,this.hasCheck=!1,this.hasRegister=!1,this.hasReady=!1,this.cbBus=[],this.jsApiList=["launchApplication","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"],this.version="1.4"}return window.kgWxEnvir||(window.kgWxEnvir=new o,window.hash=window.location.hash,function(){"onhashchange"in window&&(void 0===document.documentMode||8==document.documentMode)?window.onhashchange=function(){window.kgWxEnvir.hasCheck=!1,window.kgWxEnvir.hasRegister=!1,window.kgWxEnvir.hasReady=!1,window.kgWxEnvir.init()}:setInterval(function(){window.location.hash!=window.hash&&(window.hash=window.location.hash,window.kgWxEnvir.hasCheck=!1,window.kgWxEnvir.hasRegister=!1,window.kgWxEnvir.hasReady=!1,window.kgWxEnvir.init())},150)}()),o.prototype.init=function(e,t){e&&e.jsApiList&&Array.isArray(e.jsApiList)&&(this.jsApiList=this.jsApiList.concat(e.jsApiList)),e&&e.version&&(this.version=e.version),-1!=window.location.origin.indexOf("kugou.com")?this.this_url=encodeURIComponent(window.location.href):this.this_url=encodeURIComponent("http://kugou.com");var n=this;n.loadWxJs(function(){if(n.hasReady)t&&t(window.wx);else if(/MicroMessenger/i.test(navigator.userAgent)){if(n.cbBus.push(t),n.hasCheck)return;n.wxRegisterTimeout&&clearTimeout(n.wxRegisterTimeout),n.wxRegisterTimeout=setTimeout(function(){n.hasCheck=!0,n.getSignature()},500)}})},o.prototype.loadWxJs=function(e){if(window.wx||this.hasLoadJS)e&&e();else{this.hasLoadJS=!0;var t=document.createElement("script");t.type="text/javascript",t.readyState?t.onreadystatechange=function(){"loaded"!=t.readyState&&"complete"!=t.readyState||(t.onreadystatechange=null,e&&e())}:t.onload=function(){e&&e()},"1.6"===this.version?t.src="https://staticssl.kugou.com/common/js/kg-jweixin-1.6.0.js":t.src="https://staticssl.kugou.com/common/js/kg-jweixin-1.4.0.js",document.getElementsByTagName("head")[0].appendChild(t)}},o.prototype.getSignature=function(){var e=this;e.useNewShare?(e.jsApiList.push("updateAppMessageShareData"),e.jsApiList.push("updateTimelineShareData"),n({url:"https://mwechats.kugou.com/service/jssdk/getSignature?sdk=140&caller=kugou_web&url="+e.this_url,success:function(t){t&&(window.wx.config({beta:!0,debug:!1,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:e.jsApiList}),e.hasRegister=!0,window.wx.ready(function(){e.hasReady=!0,e.cbBus.forEach(function(e){e&&e(window.wx)})}))}})):n({url:"https://mwechats.kugou.com/jssdk/getSignature?sdk=140&caller=kugou_mobile&url="+e.this_url,success:function(t){t&&(window.wx.config({debug:!1,beta:!0,appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:e.jsApiList}),e.hasRegister=!0,window.wx.ready(function(){e.hasReady=!0,e.cbBus.forEach(function(e){e&&e(window.wx)})}))}})},o.prototype.share=function(e){if(!this.hasRegister)return"还未完成初始化，请在init回调中调用share方法";window.wx.ready(function(){window.wx.onMenuShareAppMessage({title:e.title,desc:e.content,link:e.url,imgUrl:e.img,trigger:function(e){},success:function(e){},cancel:function(e){},fail:function(e){}}),window.wx.onMenuShareTimeline({title:e.title,desc:e.content,link:e.url,imgUrl:e.img,trigger:function(e){},success:function(e){},cancel:function(e){},fail:function(e){}}),window.wx.onMenuShareQQ({title:e.title,desc:e.content,link:e.url,imgUrl:e.img,success:function(){},cancel:function(){}}),window.wx.onMenuShareQZone({title:e.title,desc:e.content,link:e.url,imgUrl:e.img,success:function(){},cancel:function(){}}),window.wx.onMenuShareWeibo({title:e.title,desc:e.content,link:e.url,imgUrl:e.img,success:function(){},cancel:function(){}})})},{init:e,share:t,getUserInfo:i}}();window.KgWebMobileCall=window.KgWebMobileCall||{};var c={title:document.title,url:location.href,content:"",img:"",projectid:"1018"},l=function(){function e(e){var t=encodeURIComponent(i.title),n=encodeURIComponent(i.url),a=encodeURIComponent(i.content),s=encodeURIComponent(i.img),c=i.hdImg?encodeURIComponent(i.hdImg):"",l=encodeURIComponent(i.swf||"");switch(e){case"qzome":case"qzone":o="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey",r=["url="+n,"title="+t,"desc="+a,"pics="+s,"summary="+a].join("&");break;case"rr":i.popupHeight=560,o="https://widget.renren.com/dialog/share",r=["link="+n,"title="+t,"image_src="+s,"description="+a].join("&");break;case"sina":i.popupWidth=615,i.popupHeight=505,o="https://service.weibo.com/share/share.php",r=["url="+n,"appkey="+i.appkey,"title="+t,"pic="+(c||s),"ralateUid="+i.ralateUid].join("&");break;case"qq":i.popupWidth=700,i.popupHeight=680;var u=encodeURIComponent(i.appkey),d=s;o="https://v.t.qq.com/share/share.php",r=["title="+t,"url="+n,"appkey="+u,"site="+i.site,"pic="+d].join("&");break;case"qq_client":i.popupWidth=765,i.popupHeight=620,o="https://connect.qq.com/widget/shareqq/index.html",r=["title="+t,"desc="+a,"url="+n,"site="+i.site,"pics="+d,"flash="+l,"summary="+encodeURIComponent("听音乐，找酷狗")].join("&");break;default:return}}function t(){var e=(screen.width-i.popupWidth)/2,t=(screen.height-i.popupHeight)/2,n=o+"?"+r;window.open(n,"_blank","width="+i.popupWidth+",height="+i.popupHeight+",left="+e+",top="+t)||(location.href=n)}function n(n,o){i=a(i,o||{}),e(n),t()}var i={popupWidth:615,popupHeight:505,title:"",url:"",content:"",img:"",swf:"",site:"",appkey:"",source:"",ralateUid:""},o="",r="";return{init:n}}(),u=function(){function e(e){window.setShareInfo&&window.setShareInfo({title:e.title,summary:e.content,pic:e.img,url:e.url})}return o.isMobileQQ&&e(c),{share:e}}(),d=function(){function e(e){s.share(e)}return/MicroMessenger/i.test(navigator.userAgent)&&s.init(function(){e(c)}),{wxShare:e}}();return function(e){function n(){document.getElementById("alertWeixin")&&document.getElementById("alertWeixin").remove();var e=document.createElement("div");e.style.cssText="position: fixed;top: 0;left: 0;width: 100%;height: 100%;z-index: 10000;background: rgba(0,0,0,.7);",e.id="alertWeixin",document.body.appendChild(e),e.innerHTML=' <img src="https://imgessl.kugou.com/h5_pic/20160526105745452169.png" style="width: 100%;display: block;">',clearTimeout(p),e.addEventListener("click",function(){clearTimeout(p),document.getElementById("alertWeixin")&&document.getElementById("alertWeixin").remove()}),p=setTimeout(function(){document.getElementById("alertWeixin")&&document.getElementById("alertWeixin").remove()},3e3)}function i(){l.init("sina",c)}function r(){if(e.isInClient()&&5==c.type)return void e.shareMiniProgram({type:c.mpType||1,id:c.id||"",url:c.url||location.href,path:c.path||"",ver:c.ver||0,title:c.title||document.title,doc:c.content||"",pic:c.img});if(o.isFanxing){var a={image:c.img,link:c.url||location.href,desc:c.content,title:c.title||document.title};t({cmd:"610",jsonStr:{shareList:["onShareWechat","onShareTimeline","onShareQQ","onShareQzone","onShareSina"],onShareWechat:a,onShareTimeline:a,onShareQQ:a,onShareQzone:a,onShareSina:a},callbackName:"mobileCall.FxShare"})}else{var r;r=4==c.type?{linkUrl:encodeURIComponent(c.url||location.href),content:c.content,title:c.title||document.title,imageData:c.img,screenshot:c.screenshot||!1,copyContent:c.copyContent||""}:{linkUrl:encodeURIComponent(c.url||location.href),picUrl:c.img,content:c.content,title:c.title||document.title,copyContent:c.copyContent||"",shareChannel:c.shareChannel||[1,2,3,4,5]};var s={type:c.type||"3",shareName:c.shareName||"",hash:c.hash||"",listID:c.listID||"",suid:c.suid||"",slid:c.slid||"",imgUrl:c.imgUrl||"",filename:c.filename||"",duration:c.duration||"",topicName:c.topicName||"",singerName:c.singerName||"",needSkin:0==c.needSkin?0:1,shareData:r};if(c.platform&&(s.platform_type=c.platform),c.multiCB)s.multiCB=c.multiCB,e.share(s,null,n,i);else if(c.hdImg||c.wbContent){var l=c.hdImg||c.img;window.getBase64(l,function(t){window.multiCallBack=function(){var n={type:"weibo",linkUrl:c.url||location.href,content:c.wbContent||c.content,title:c.title||document.title,list:[t]};e.multiShare(n)},s.multiCB="multiCallBack",e.share(s,null,n,i)})}else e.share(s,null,n,i)}}function s(e){e.content&&e.content.length>40&&(e.content=e.content.substring(0,40)),c=a(c,e||{})}function h(e){s(e),u.share(c),d.wxShare(c)}function m(e){s(e),u.share(c),d.wxShare(c),r()}var p;return{setShareData:s,shareAll:r,shareWx:n,shareOther:i,resetShareData:h,resetShare:m}}(r)});
//# sourceMappingURL=share.min.js.map
